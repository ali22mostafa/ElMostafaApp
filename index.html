<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØµØ·ÙÙ‰ Ù„Ù„Ø­ÙˆÙ…</title>
  <link rel="manifest" href="manifest.json">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background-color: #111;
      color: #fff;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }

    .specual{
      background-color: yellow !important;
      color: #000 !important;
    }

    header {
      background-color: #000;
      color: yellow;
      padding: 1rem;
      text-align: center;
      font-weight: bold;
      font-size: 1.2rem;
      animation: fadeInDown 0.8s ease-out;
      position: relative;
      overflow: hidden;
    }

    .logo  {
      display: block;
      margin: 10px auto;
      max-width: 220px;
      border-radius: 20px !important;
      animation: bounceIn 1s ease-out, pulse 2s 2s ease-in-out infinite;
      transform-origin: center;
      transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .logo:hover {
      transform: scale(1.05) rotate(2deg);
    }

    nav {
      background-color: #222;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      gap: 1rem;
      position: relative;
      text-align: center !important;
      animation: fadeIn 0.8s ease-out;
    }

    .nav-toggle {
      display: none;
      cursor: pointer;
      color: yellow;
      background: #333;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .nav-toggle:hover {
      transform: scale(1.1);
      background-color: #444;
    }

    .nav-links {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      perspective: 1000px;
    }

    .nav-links a {
      color: white;
      text-decoration: none;
      padding: 0.5rem 1rem;
      background: #444;
      border-radius: 10px;
      white-space: nowrap;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      transform-style: preserve-3d;
      position: relative;
    }

    .nav-links a:hover {
      transform: translateY(-5px) rotateX(15deg);
      box-shadow: 0 10px 20px rgba(255, 255, 0, 0.4);
      background: #555;
    }

    .nav-links a::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 100%;
      height: 5px;
      background: yellow;
      border-radius: 0 0 10px 10px;
      transform: scaleX(0);
      transform-origin: center;
      transition: transform 0.3s ease;
    }

    .nav-links a:hover::after {
      transform: scaleX(1);
    }

    #searchInput {
      padding: 0.5rem;
      border-radius: 5px;
      border: none;
      width: 250px;
      max-width: 100%;
      font-size: 20px;
      text-align: center;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      background-color: #333;
      color: white;
    }

    #searchInput:focus {
      outline: none;
      box-shadow: 0 0 15px yellow, 0 0 30px rgba(255, 255, 0, 0.2);
      transform: scale(1.05);
      background-color: #444;
    }

    #searchInput::placeholder {
      color: #aaa;
      transition: all 0.3s ease;
    }

    #searchInput:focus::placeholder {
      opacity: 0.5;
      transform: translateY(-5px);
    }

    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      padding: 1rem;
    }

    .product-box {
      background-color: #1a1a1a;
      border: 3px solid yellow;
      border-radius: 15px;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      opacity: 0;
      transform: translateY(30px) rotateX(10deg);
      animation: fadeInUp 0.6s ease-out forwards;
      animation-delay: calc(var(--order) * 0.1s);
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      perspective: 1000px;
      transform-style: preserve-3d;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .product-box:hover {
      transform: translateY(-10px) rotateX(0deg);
      box-shadow: 0 15px 30px rgba(255, 255, 0, 0.3);
      border-color: #ffcc00;
    }

    .product-box h2 {
      background-color: yellow;
      color: black;
      padding: 0.7rem;
      border-radius: 10px;
      text-align: center;
      font-size: 1.1rem;
      margin-bottom: 1rem;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      transform-origin: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .product-box h2:hover {
      transform: scale(1.05) rotate(-1deg);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
      background-color: #ffdb4d;
    }

    .product-image {
      width: 100%;
      height: 80px;
      object-fit: cover;
      border-radius: 10px;
      margin-bottom: 1rem;
      border: 2px solid yellow;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      transform-style: preserve-3d;
    }

    .product-image:hover {
      transform: scale(1.03) rotateY(5deg);
      box-shadow: 0 8px 20px rgba(255, 255, 0, 0.4);
      border-color: #ffcc00;
    }

    .product-item {
      background-color: #000;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      padding: 0.6rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.95rem;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      position: relative;
      overflow: hidden;
    }

    .product-item:hover {
      transform: translateX(10px);
      background-color: #222;
    }

    .product-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 0, 0.2), transparent);
      transition: all 0.6s ease;
    }

    .product-item:hover::before {
      left: 100%;
    }

    .product-item span:last-child {
      background-color: yellow;
      color: black;
      font-weight: bold;
      border-radius: 10%;
      padding: 0.4rem 0.7rem;
      min-width: 40px;
      text-align: center;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      transform-origin: center;
    }

    .product-item:hover span:last-child {
      transform: scale(1.15) rotate(5deg);
      background-color: #ffdb4d;
    }

    .deleted-product {
      opacity: 0.5;
      text-decoration: line-through;
      background-color: #333 !important;
      pointer-events: none;
    }

    .deleted-product span:last-child {
      background-color: #dc3545 !important;
      color: white !important;
    }

    /* Animations */
    @keyframes fadeIn {
      from { 
        opacity: 0;
        transform: translateY(-10px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px) rotateX(10deg);
      }
      to {
        opacity: 1;
        transform: translateY(0) rotateX(0deg);
      }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    @keyframes bounceIn {
      0% {
        opacity: 0;
        transform: scale(0.3) rotate(-10deg);
      }
      50% {
        opacity: 1;
        transform: scale(1.1) rotate(5deg);
      }
      70% {
        transform: scale(0.95) rotate(-2deg);
      }
      100% {
        transform: scale(1) rotate(0deg);
      }
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(255, 255, 0, 0.7);
      }
      50% {
        transform: scale(1.05);
      }
      70% {
        box-shadow: 0 0 0 15px rgba(255, 255, 0, 0);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(255, 255, 0, 0);
      }
    }

    /* Highlight animation for search results */
    .highlight {
      animation: highlight 1.5s ease;
    }

    @keyframes highlight {
      0% { 
        background-color: yellow; 
        color: black;
        transform: scale(1.05);
      }
      50% {
        box-shadow: 0 0 20px yellow;
      }
      100% { 
        background-color: inherit; 
        color: inherit;
        transform: scale(1);
      }
    }

    /* Floating animation */
    @keyframes float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    /* Shake animation */
    @keyframes shake {
      0%, 100% {
        transform: translateX(0);
      }
      10%, 30%, 50%, 70%, 90% {
        transform: translateX(-5px);
      }
      20%, 40%, 60%, 80% {
        transform: translateX(5px);
      }
    }

    /* Rotate animation */
    @keyframes rotate {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    /* Slide in from sides */
    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @media (max-width: 600px) {
      .nav-toggle {
        display: block;
      }

      .nav-links {
        display: none;
        flex-direction: column;
        width: 100%;
        margin-top: 0.5rem;
        animation: slideInDown 0.5s ease-out;
      }

      .nav-links a {
        width: 100%;
        background: #333;
        animation: fadeInLeft 0.5s ease-out;
        animation-fill-mode: both;
      }

      .nav-links.show {
        display: flex;
      }

      nav {
        flex-direction: row;
        align-items:center;
        justify-content: center;
      }

      nav input {
        width: 100%;
      }

      .product-box {
        padding: 0.8rem;
      }

      .product-box h2 {
        font-size: 1rem;
      }

      .product-item {
        font-size: 0.9rem;
        padding: 0.5rem 0.8rem;
      }

      .product-image {
        height: 150px;
      }
      
      @keyframes slideInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      @keyframes fadeInLeft {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
    }
  </style>
  
  <style>
    .whatsapp-float {
      display: flex;
      justify-content: center;
      align-items: center;
      top: 20px;
      left: 20px;
      z-index: 999;
      background-color: #222222;
      color: white;
      border-radius: 50px;
      padding: 10px 20px;
      text-decoration: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      transition: all 0.3s ease;
      animation: pulse 2s infinite, float 4s ease-in-out infinite;
      transform-style: preserve-3d;
      perspective: 1000px;
    }

    .whatsapp-float:hover {
      background-color: #222222;
      transform: scale(1.05) rotateY(10deg);
      animation: none;
      box-shadow: 0 8px 25px rgba(37, 211, 102, 0.5);
    }

    .whatsapp-content {
      display: flex;
      align-items: center;
      transition: all 0.3s ease;
    }

    .whatsapp-content:hover {
      transform: scale(1.05);
    }

    .whatsapp-content img {
      width: 32px;
      height: 32px;
      margin-left: 10px;
      transition: all 0.3s ease;
    }

    .whatsapp-float:hover .whatsapp-content img {
      animation: shake 0.5s ease;
    }

    .whatsapp-content span {
      font-size: 16px;
      font-weight: bold;
      white-space: nowrap;
      transition: all 0.3s ease;
    }

    .whatsapp-float:hover .whatsapp-content span {
      color: #25D366;
    }

    @media (max-width: 480px) {
      .whatsapp-float {
        padding: 8px 12px;
        animation: pulse 2s infinite;
      }

      .whatsapp-content span {
        font-size: 18px;
      }

      .whatsapp-content img {
        width: 28px;
        height: 28px;
        margin-left: 8px;
      }
    }
  </style>

  <style>
    .alert-toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #4CAF50;
      color: white;
      padding: 15px;
      border-radius: 5px;
      animation: fadeIn 0.5s, fadeOut 0.5s 2.5s;
      animation-fill-mode: forwards;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
      text-align: center;
    }

    .admin{
      display: none;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    .alert-toast::before {
      content: "âœ“";
      font-size: 20px;
    }
  </style>

  <style>
    /* ØªØµÙ…ÙŠÙ… Ø²Ø¬Ø§Ø¬ÙŠ Ù…ØªÙˆØ§Ø²Ù† */
    .user-info {
      position: fixed;
      top: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(15, 20, 30, 0.7);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      padding: 10px 20px;
      border-radius: 50px;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
      min-width: 300px;
      max-width: 90%;
      box-sizing: border-box;
      justify-content: center;
    }

    #welcome-message {
      color: #f5f5f5;
      font-weight: 500;
      font-size: 15px;
      letter-spacing: 0.3px;
      position: relative;
      padding-right: 25px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 180px;
    }

    #welcome-message::after {
      content: "";
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23d1c4e9"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>') no-repeat center;
      background-size: contain;
    }

    .auth-buttons {
      display: flex;
      gap: 10px;
    }

    .auth-btn {
      padding: 8px 16px;
      background: rgba(120, 144, 156, 0.4);
      color: #eceff1;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.25s ease;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      min-width: 80px;
      text-align: center;
      white-space: nowrap;
    }

    .auth-btn:hover {
      background: rgba(96, 125, 139, 0.6);
      transform: translateY(-1px);
    }

    /* Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© â˜° */
    .menu-toggle {
      display: none;
      background: #444;
      color: white;
      padding: 6px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 18px;
    }

    .user-menu {
      display: flex;
      flex-direction: row;
      gap: 10px;
    }

    .user-menu button {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      background: #666;
      color: #fff;
      cursor: pointer;
      transition: 0.3s;
    }
    .user-menu button:hover {
      background: #777;
    }

    /* ğŸ“± Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    @media (max-width: 768px) {
      .user-info {
        padding: 8px 15px;
        gap: 12px;
        min-width: auto;
        width: auto;
      }
      
      #welcome-message {
        font-size: 14px;
        padding-right: 22px;
        max-width: 150px;
      }
      
      #welcome-message::after {
        width: 16px;
        height: 16px;
      }
      
      .auth-btn {
        padding: 7px 14px;
        font-size: 20px;
        min-width: 70px;
      }
    }

    @media (max-width: 600px) {
      .menu-toggle {
        display: block;
      }
      
      .user-menu {
        display: none;
        flex-direction: column;
        position: absolute;
        top: 100%;
        left: 0;
        background: #333;
        border-radius: 8px;
        padding: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        z-index: 9999;
        min-width: 150px;
      }
      
      .user-menu.show {
        display: flex;
      }
    }

    @media (max-width: 480px) {
      .user-info {
        top: 15px;
        padding: 6px 12px;
        border-radius: 40px;
      }
      
      .auth-buttons {
        gap: 8px;
      }
      
      .auth-btn {
        padding: 6px 12px;
        min-width: 60px;
      }
    }

    @media (max-width: 360px) {
      .auth-btn {
        padding: 6px 10px;
        font-size:18px;
        min-width: 50px;
      }
    }
  </style>

  <style>
    .update-info-badge {
      position: fixed;
      bottom: 80px;
      left: 20px;
      background: #2196F3;
      color: white;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      z-index: 999;
      box-shadow: 0 2px 10px rgba(33, 150, 243, 0.3);
      display: none;
      align-items: center;
      gap: 5px;
    }
    
    .update-info-badge.show {
      display: flex;
      animation: slideInLeft 0.3s ease;
    }
  </style>
</head>
<body>

<button  style="display: none !important;" class="admin" id="admin3" onclick="uploadAllProductsToFirebase()" style="
  position: fixed;
  bottom: 20px;
  left: 20px;
  background-color: green;
  color: white;
  padding: 12px 18px;
  font-size: 16px;
  border: none;
  border-radius: 10px;
  z-index: 1000;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
">
ğŸ“¤ Ø±ÙØ¹ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„Ù‰ ÙØ§ÙŠØ±Ø¨ÙŠØ²
</button>

<div id="update-info-badge" class="update-info-badge">
  <span id="update-count">0</span> Ù…Ù†ØªØ¬ Ù…Ø­Ø¯Ø«
</div>

<div id="user-info" class="user-info" style="display: none;">
  <span id="welcome-message">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø§Ø³Ù…_Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</span>
  <div class="menu-toggle" onclick="toggleUserMenu()">â˜°</div>
  <div class="user-menu" id="user-menu">
    <button id="profile-btn" class="auth-btn" onclick="window.location.href='profile.html'">Ù…ØªØ§Ø¨Ø¹Ù‡ Ø·Ù„Ø¨Ø§ØªÙŠ</button>
    <button id="logout-btn" class="auth-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
  </div>
</div>

<div id="login-signup-buttons" class="user-info">
  <button id="login-btn" class="auth-btn" onclick="window.location.href='login.html'">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
  <button id="signup-btn" class="auth-btn" onclick="window.location.href='signup.html'">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
</div>

<header>
  <img src="img/zz.jpg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©" class="logo" />
  <p>Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØµØ·ÙÙ‰ Ù„ØªØµÙ†ÙŠØ¹ Ø§Ù„Ù„Ø­ÙˆÙ… ÙˆØ¨ÙŠØ¹ Ø¬Ù…ÙŠØ¹ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª</p>
  <a href="https://wa.me/201002685167?text=Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø£ÙˆØ¯ Ø·Ù„Ø¨ Ø£ÙˆØ±Ø¯Ø± Ù…Ù† Ù…ÙˆÙ‚Ø¹ÙƒÙ…" class="whatsapp-float" target="_blank" title="ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨">
    <div class="whatsapp-content">
      <img src="https://img.icons8.com/color/48/000000/whatsapp--v1.png" alt="WhatsApp">
      <span style="text-align: center;">ÙÙŠ Ø­Ø§Ù„Ù‡ ÙˆØ¬ÙˆØ¯ Ø´ÙƒÙˆÙŠ ÙŠØ±Ø¬ÙŠ Ø§Ù„ØªÙˆØ§ØµÙ„</span>
    </div>
  </a>
  <div id="cart-icon" style="position: fixed; bottom: 20px; right: 20px; z-index: 999; background-color: yellow; color: black; padding: 10px 15px; border-radius: 50%; font-weight: bold; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.3);" onclick="openCart()">
    ğŸ›’ <span id="cart-count">0</span>
  </div>
</header>

<div class="offers-slider" id="offersContainer">
  <div id="offersTrack"></div>
</div>

<nav>
  <div class="nav-toggle" onclick="setupNavigation()">â˜° Ù‚Ø§Ø¦Ù…Ù‡ </div>
  <div class="nav-links">
    <a href="location.html">Ù…ÙˆÙ‚Ø¹ Ø´Ø±ÙƒÙ‡ Ø§Ù„Ù…ØµØ·ÙÙŠ " Ø§Ù„Ù„ÙˆÙƒÙŠØ´Ù†" </a>
    <a href="placeOfElmostafa.html">ØªØ¹Ø±Ù Ø¹Ù„ÙŠ Ù…Ù†Ø§ÙØ° Ø¨ÙŠØ¹ ØªØ§Ø¨Ø¹Ù‡ Ù„Ø´Ø±ÙƒÙ‡ Ø§Ù„Ù…ØµØ·ÙÙŠ </a>
    <a href="offers.html">Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…ØµØ·ÙÙŠ</a>
    <a href="slider.html">ØªØ¹Ø±Ù Ø¹Ù„ÙŠ Ù…ØµÙ†Ø¹Ø§Øª Ø§Ù„Ù…ØµØ·ÙÙŠ</a>
    <a href="admin-customers.html" class="admin" id="admin4">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ </a>
    <a href="#" onclick="checkPassword(event)" class="admin" id="admin1">dashboard</a>
    <a href="#" onclick="checkPassword1(event)" class="admin" id="admin2">dashboard order</a>
  </div>
  <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬...">
</nav>

<div class="container" id="productContainer">
  <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… -->
</div>

<!-- âœ… Ø±ÙˆØ§Ø¨Ø· Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
  // =============================================
  // ğŸ”¥ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©
  // =============================================

  // âœ… ØªÙƒÙˆÙŠÙ† Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBKtxMNJ3n_YIsy671sbhlk8Qm1yt5uSB4",
    authDomain: "mostafa-products.firebaseapp.com",
    projectId: "mostafa-products",
    storageBucket: "mostafa-products.firebasestorage.app",
    messagingSenderId: "841270845665",
    appId: "1:841270845665:web:f2f857112688b8b8be57a0"
  };

  // âœ… ØªÙ‡ÙŠØ¦Ø© Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // âœ… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø«Ù„Ù‰
  db.settings({
    cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED
  });

  // âœ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
  db.enablePersistence()
    .catch((err) => {
      console.log("Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…:", err);
    });

  // =============================================
  // ğŸ›’ Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø³Ù†
  // =============================================
  let cart = JSON.parse(localStorage.getItem('cart')) || [];

  function updateCartCount() {
    const count = cart.reduce((total, item) => total + item.quantity, 0);
    const cartCountElement = document.getElementById('cart-count');
    if (cartCountElement) {
      cartCountElement.textContent = count;
    }
  }

  function openCart() {
    window.location.href = 'cart.html';
  }

  // =============================================
  // ğŸ“¦ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø°ÙƒÙŠ (Ø§Ù„Ø¬Ø¯ÙŠØ¯)
  // =============================================
  class SmartProductManager {
    constructor() {
      this.products = new Map();
      this.userLastUpdate = 0;
      this.isUpdating = false;
      this.initialLoadDone = false;
      this.updateCount = 0;
    }

    async initialize() {
      console.log("ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø°ÙƒÙŠ...");
      
      // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„ÙŠ
      this.loadFromCache();
      
      // 2. ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù…Ù† Ø§Ù„ÙƒØ§Ø´
      this.renderProductsFromCache();
      
      // 3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØ­Ø¯ÙŠØ«Ø§Øª
      const needsUpdate = await this.checkForUpdates();
      
      if (needsUpdate) {
        console.log("ğŸ”„ ÙŠÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ...");
        await this.smartUpdate();
      } else {
        console.log("âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©");
      }
      
      this.initialLoadDone = true;
      console.log("âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø°ÙƒÙŠ Ø¬Ø§Ù‡Ø²");
    }

    async checkForUpdates() {
      try {
        // Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ù† Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ²
        const systemDoc = await db.collection('system').doc('update').get();
        const systemData = systemDoc.data();
        
        if (!systemData || !systemData.globalLastUpdate) {
          console.log("âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…");
          return false;
        }
        
        // ØªØ­ÙˆÙŠÙ„ timestamp Ø¥Ù„Ù‰ Ø¹Ø¯Ø¯
        const globalLastUpdate = systemData.globalLastUpdate.toDate().getTime();
        this.userLastUpdate = localStorage.getItem('userLastUpdate') || 0;
        
        console.log(`ğŸ“… Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©: global=${globalLastUpdate}, user=${this.userLastUpdate}`);
        
        // Ø¥Ø°Ø§ globalLastUpdate Ø£ÙƒØ¨Ø± Ù…Ù† userLastUpdateØŒ ÙŠÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ«Ø§Øª
        return globalLastUpdate > this.userLastUpdate;
        
      } catch (error) {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª:", error);
        return false;
      }
    }

    async smartUpdate() {
      if (this.isUpdating) return;
      this.isUpdating = true;
      
      console.log("ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª...");
      
      try {
        // 1. Ø¬Ù„Ø¨ globalLastUpdate Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…
        const systemDoc = await db.collection('system').doc('update').get();
        const systemData = systemDoc.data();
        const globalLastUpdate = systemData.globalLastUpdate.toDate();
        
        // 2. Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ø¨Ø¹Ø¯ userLastUpdate
        const userLastUpdateDate = new Date(parseInt(this.userLastUpdate));
        
        const updatedProductsSnapshot = await db.collection("products")
          .where("lastUpdated", ">", userLastUpdateDate)
          .get();
        
        let updatedCount = 0;
        let deletedCount = 0;
        
        // 3. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
        updatedProductsSnapshot.forEach(doc => {
          const productData = doc.data();
          
          if (productData.deleted) {
            // Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø­Ø°ÙˆÙ
            this.removeProduct(doc.id);
            deletedCount++;
          } else {
            // Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ Ù…Ø¹Ø¯Ù„
            this.products.set(doc.id, productData);
            this.updateProductInUI(doc.id, productData);
            updatedCount++;
          }
        });
        
        // 4. Ø­ÙØ¸ userLastUpdate Ø§Ù„Ø¬Ø¯ÙŠØ¯
        this.userLastUpdate = globalLastUpdate.getTime();
        localStorage.setItem('userLastUpdate', this.userLastUpdate);
        
        // 5. Ø­ÙØ¸ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ø¯Ø«
        this.saveToCache();
        
        // 6. Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
        this.showUpdateNotification(updatedCount, deletedCount);
        
        console.log(`âœ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°ÙƒÙŠ: ${updatedCount} Ù…Ù†ØªØ¬ Ù…Ø­Ø¯Ø«ØŒ ${deletedCount} Ù…Ù†ØªØ¬ Ù…Ø­Ø°ÙˆÙ`);
        
        this.updateCount = updatedCount + deletedCount;
        return true;
        
      } catch (error) {
        console.error("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°ÙƒÙŠ:", error);
        
        // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ÙƒØ§Ù…Ù„ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
        console.log("ğŸ”„ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª...");
        return await this.forceRefreshFromFirebase();
        
      } finally {
        this.isUpdating = false;
      }
    }

    async forceRefreshFromFirebase() {
      console.log("ğŸ“¥ Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Firebase...");
      
      this.isUpdating = true;
      try {
        const snapshot = await db.collection("products").get({ source: "server" });
        
        this.products.clear();
        const container = document.getElementById("productContainer");
        if (container) container.innerHTML = '';
        
        let loadedCount = 0;
        
        snapshot.forEach(doc => {
          const productData = doc.data();
          if (!productData.deleted) {
            this.products.set(doc.id, productData);
            loadedCount++;
          }
        });
        
        // Ø¬Ù„Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ù„ØªØ­Ø¯ÙŠØ«
        const systemDoc = await db.collection('system').doc('update').get();
        const systemData = systemDoc.data();
        
        if (systemData && systemData.globalLastUpdate) {
          this.userLastUpdate = systemData.globalLastUpdate.toDate().getTime();
          localStorage.setItem('userLastUpdate', this.userLastUpdate);
        }
        
        this.saveToCache();
        this.renderProductsFromCache();
        
        console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${loadedCount} Ù…Ù†ØªØ¬`);
        return true;
        
      } catch (error) {
        console.error("âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:", error);
        return false;
      } finally {
        this.isUpdating = false;
      }
    }

    removeProduct(productId) {
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©
      this.products.delete(productId);
      
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
      const element = document.querySelector(`[data-product-id="${productId}"]`);
      if (element) {
        const productItem = element.closest('.product-item');
        if (productItem) {
          productItem.classList.add('deleted-product');
          productItem.style.pointerEvents = 'none';
          productItem.style.opacity = '0.5';
        }
      }
    }

    renderProductsFromCache() {
      console.log("ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„ÙƒØ§Ø´...");
      
      const container = document.getElementById("productContainer");
      if (!container) return;
      
      // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
      const productsByCategory = {};
      
      for (const [productId, productData] of this.products) {
        if (productData.deleted) continue;
        
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙØ¦Ø© Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø£Ùˆ ID
        let category = this.extractCategory(productId, productData.name);
        
        if (!productsByCategory[category]) {
          productsByCategory[category] = [];
        }
        
        productsByCategory[category].push({ id: productId, ...productData });
      }
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
      container.innerHTML = '';
      let boxIndex = 0;
      
      for (const [category, products] of Object.entries(productsByCategory)) {
        if (products.length === 0) continue;
        
        const productBox = document.createElement('div');
        productBox.className = 'product-box';
        productBox.style.setProperty('--order', boxIndex++);
        
        // ØµÙˆØ±Ø© Ø§Ù„ÙØ¦Ø©
        const categoryImage = this.getCategoryImage(category);
        
        productBox.innerHTML = `
          <h2>${category}</h2>
          ${categoryImage ? `<img src="${categoryImage}" class="product-image" alt="${category}" />` : ''}
        `;
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        products.forEach(product => {
          const productItem = document.createElement('div');
          productItem.className = 'product-item';
          productItem.setAttribute('data-product-id', product.id);
          
          const price = product.price || 0;
          
          productItem.innerHTML = `
            <span class="product-name" data-product-id="${product.id}">${product.name}</span>
            <span class="price">${price} Ø¬</span>
          `;
          
          // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø±
          productItem.addEventListener('click', () => {
            this.handleProductClick(product.id, product.name, price);
          });
          
          productBox.appendChild(productItem);
        });
        
        container.appendChild(productBox);
      }
      
      console.log(`âœ… ØªÙ… Ø¹Ø±Ø¶ ${this.products.size} Ù…Ù†ØªØ¬ ÙÙŠ ${Object.keys(productsByCategory).length} ÙØ¦Ø©`);
    }

    extractCategory(productId, productName) {
      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙØ¦Ø© Ù…Ù† Ø§Ù„Ù€ ID
      if (productId.includes('mustafa-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØµØ·ÙÙŠ';
      if (productId.includes('hamd-')) return 'Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ Ø§Ù„Ø­Ù…Ø¯';
      if (productId.includes('hasan-') || productId.includes('hussein-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø³Ù† ÙˆØ§Ù„Ø­Ø³ÙŠÙ†';
      if (productId.includes('atyab-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ø£Ø·ÙŠØ§Ø¨';
      if (productId.includes('salah-')) return 'Ù…Ù†ØªØ¬Ø§Øª ØµÙ„Ø§Ø­ Ø¹Ø¨Ø¯ Ø§Ù„ÙØªØ§Ø­';
      if (productId.includes('mazaya-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ù…Ø²Ø§ÙŠØ§';
      if (productId.includes('almarai-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¹ÙŠ';
      if (productId.includes('joker-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬ÙˆÙƒØ±';
      if (productId.includes('alabed-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø§Ø¨Ø¯';
      if (productId.includes('ranja-') || productId.includes('fish-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø­Ø±ÙŠØ©';
      if (productId.includes('dayam-') || productId.includes('walaateen-') || productId.includes('roody-')) return 'ØªØ´ÙƒÙŠÙ„Ù‡';
      if (productId.includes('cooky-')) return 'Ù…Ù†ØªØ¬Ø§Øª ÙƒÙˆÙƒÙŠ';
      if (productId.includes('basma-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø³Ù…Ù‡';
      if (productId.includes('montana-') || productId.includes('gefrex-') || productId.includes('shahrazad-')) return 'ØªØ´ÙƒÙŠÙ„Ù‡ Ø®Ø¶Ø±Ø§ÙˆØ§Øª';
      if (productId.includes('maxtella-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ù…Ø§ÙƒØ³ ØªÙŠÙ„Ø§';
      if (productId.includes('hikaya-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ø­ÙƒØ§ÙŠÙ‡';
      if (productId.includes('rotana-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ø±ÙˆØªØ§Ù†Ø§';
      if (productId.includes('shika-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ø´ÙŠÙƒØ§ØªÙŠØªØ§';
      if (productId.includes('halawany-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ø­Ù„ÙˆØ§Ù†ÙŠ';
      if (productId.includes('fries-') || productId.includes('luncheon-')) return 'Ø¨Ø·Ø§Ø·Ø³ ÙˆÙ„Ø§Ù†Ø´ÙˆÙ†';
      if (productId.includes('butter-')) return 'Ø²Ø¨Ø¯Ù‡';
      if (productId.includes('lavida-')) return 'Ù…Ù†ØªØ¬Ø§Øª Ù„Ø§ÙÙŠØ¯Ø§';
      if (productId.includes('sharif-') || productId.includes('shad-')) return 'ØªØ´ÙƒÙŠÙ„Ù‡ Ø§Ù„Ø­Ø±ÙŠÙ ÙˆØ´Ù‡Ø¯';
      if (productId.includes('sausage-') || productId.includes('strips-')) return 'Ø³ÙˆØ³ÙŠØ³ ÙˆØ§Ø³ØªØ±Ø¨Ø³';
      if (productId.includes('salim-')) return 'ÙƒØ±Ø§ØªÙŠÙ†';
      
      // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±ÙØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… "Ø£Ø®Ø±Ù‰"
      return 'Ø£Ø®Ø±Ù‰';
    }

    getCategoryImage(category) {
      const images = {
        'Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØµØ·ÙÙŠ': 'img/5.jpeg',
        'Ù…ÙˆØªØ²Ø§Ø±ÙŠÙ„Ø§ Ø§Ù„Ø­Ù…Ø¯': 'img/ha1.png',
        'Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø³Ù† ÙˆØ§Ù„Ø­Ø³ÙŠÙ†': 'img/Ø§Ù„Ø­Ø³Ù†.png',
        'Ù…Ù†ØªØ¬Ø§Øª Ø£Ø·ÙŠØ§Ø¨': 'img/ÙØ±Ø§Ø® Ø£Ø·ÙŠØ§Ø¨ Ù…Ù‚Ø±Ù…Ø´.jpg',
        'Ù…Ù†ØªØ¬Ø§Øª ØµÙ„Ø§Ø­ Ø¹Ø¨Ø¯ Ø§Ù„ÙØªØ§Ø­': 'img/ØµÙ„Ø§Ø­ Ø¹Ø¨Ø¯Ø§Ù„ÙØªØ§Ø­.jpg',
        'Ù…Ù†ØªØ¬Ø§Øª Ù…Ø²Ø§ÙŠØ§': 'img/Ù…Ø²Ø§ÙŠØ§.jpeg',
        'Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¹ÙŠ': 'img/Ù…Ø±Ø§Ø¹ÙŠ.jpg',
        'Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬ÙˆÙƒØ±': 'img/Ø¬ÙˆÙƒØ±.webp',
        'Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø§Ø¨Ø¯': 'img/abbbd1.png',
        'Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø­Ø±ÙŠØ©': 'img/ngmA.jpg',
        'ØªØ´ÙƒÙŠÙ„Ù‡': 'img/dayam.jpg',
        'Ù…Ù†ØªØ¬Ø§Øª ÙƒÙˆÙƒÙŠ': 'img/images (1).jpeg',
        'Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø³Ù…Ù‡': 'img/b.webp',
        'ØªØ´ÙƒÙŠÙ„Ù‡ Ø®Ø¶Ø±Ø§ÙˆØ§Øª': 'img/mo.png',
        'Ù…Ù†ØªØ¬Ø§Øª Ù…Ø§ÙƒØ³ ØªÙŠÙ„Ø§': 'img/x.jpg',
        'Ù…Ù†ØªØ¬Ø§Øª Ø­ÙƒØ§ÙŠÙ‡': 'img/hikaya.jpg',
        'Ù…Ù†ØªØ¬Ø§Øª Ø´ÙŠÙƒØ§ØªÙŠØªØ§': 'img/shika.jpeg',
        'Ù…Ù†ØªØ¬Ø§Øª Ø­Ù„ÙˆØ§Ù†ÙŠ': 'img/halawany.png',
        'Ù…Ù†ØªØ¬Ø§Øª Ù„Ø§ÙÙŠØ¯Ø§': 'img/Ù„Ø§ÙÙŠØ¯Ø§ 1.webp'
      };
      
      return images[category] || null;
    }

    updateProductInUI(productId, productData) {
      const element = document.querySelector(`[data-product-id="${productId}"]`);
      if (!element) {
        // Ø§Ù„Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ØŒ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶Ù‡ ÙÙŠ renderProductsFromCache
        this.products.set(productId, productData);
        this.saveToCache();
        this.renderProductsFromCache();
        return;
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù…
      if (element.textContent.trim() !== productData.name) {
        element.textContent = productData.name;
        setTimeout(() => {
  location.reload();
}, 800);

        
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø±
      const priceElement = element.nextElementSibling;
      if (priceElement && priceElement.classList.contains('price')) {
        const newPrice = `${productData.price} Ø¬`;
        if (priceElement.textContent.trim() !== newPrice) {
          priceElement.textContent = newPrice;
         setTimeout(() => {
  location.reload();
}, 800);

        }
      }
      
      // ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
      this.products.set(productId, productData);
      this.saveToCache();
    }

    handleProductClick(productId, productName, productPrice) {
      console.log(`ğŸ›’ Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬: ${productName}`);
      openQuantityModal(productId, productName, productPrice);
    }

    showUpdateNotification(updatedCount, deletedCount) {
      if (updatedCount === 0 && deletedCount === 0) return;
      
      const badge = document.getElementById('update-info-badge');
      const countSpan = document.getElementById('update-count');
      
      if (badge && countSpan) {
        countSpan.textContent = updatedCount + deletedCount;
        badge.classList.add('show');
        
        setTimeout(() => {
          badge.classList.remove('show');
        }, 5000);
      }
      
      let message = '';
      if (updatedCount > 0 && deletedCount > 0) {
        message = `ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« ${updatedCount} Ù…Ù†ØªØ¬ ÙˆØ­Ø°Ù ${deletedCount} Ù…Ù†ØªØ¬`;
      } else if (updatedCount > 0) {
        message = `ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« ${updatedCount} Ù…Ù†ØªØ¬`;
      } else if (deletedCount > 0) {
        message = `ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù ${deletedCount} Ù…Ù†ØªØ¬`;
      }
      
      this.showNotification(message, '#2196F3');
    }

    showNotification(message, color) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed; 
        top: 20px; 
        left: 20px; 
        background: ${color}; 
        color: white; 
        padding: 15px 20px; 
        border-radius: 8px; 
        z-index: 10000; 
        animation: slideIn 0.3s ease, fadeOut 0.5s ease 2.5s forwards;
        font-weight: bold;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 3000);
    }

    saveToCache() {
      const cacheData = {
        products: Array.from(this.products.entries()),
        userLastUpdate: this.userLastUpdate,
        timestamp: Date.now()
      };
      localStorage.setItem('smart_products_cache', JSON.stringify(cacheData));
    }

    loadFromCache() {
      const cache = localStorage.getItem('smart_products_cache');
      if (!cache) {
        console.log("ğŸ”„ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒØ§Ø´ Ø°ÙƒÙŠ - Ø£ÙˆÙ„ Ù…Ø±Ø©");
        return;
      }

      try {
        const { products, userLastUpdate } = JSON.parse(cache);
        this.products = new Map(products);
        this.userLastUpdate = userLastUpdate || 0;
        console.log("ğŸ”„ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ø°ÙƒÙŠ");
      } catch (e) {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©");
      }
    }
  }

  // =============================================
  // ğŸ”„ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø°ÙƒÙŠ (Ù…Ù‚ÙÙˆÙ„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)
  // =============================================
  class UpdateManager {
    constructor() {
      this.currentSystemVersion = 1;
      this.userVersion = 1;
      this.updateButton = null;
      this.initialized = false;
    }

    async initialize() {
      if (this.initialized) return;
      
      console.log("ğŸ”„ Ø¨Ø¯Ø¡ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø°ÙƒÙŠ...");
      
      // âœ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
      await this.initializeVersions();
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù…Ù‚ÙÙˆÙ„)
      this.createUpdateButton();
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØ­Ø¯ÙŠØ«Ø§Øª
      await this.checkForUpdates();
      
      this.initialized = true;
      console.log("âœ… Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¬Ø§Ù‡Ø²");
    }

    async initializeVersions() {
      try {
        // âœ… Ù†Ø¬ÙŠØ¨ system version Ù…Ù† Ø§Ù„ÙÙŠØ±Ø¨ÙŠØ² Ø£ÙˆÙ„Ø§Ù‹
        const updateDoc = await db.collection('system').doc('update').get();
        const updateData = updateDoc.data();
        
        if (updateData && updateData.updateVersion) {
          this.currentSystemVersion = updateData.updateVersion;
          console.log(`ğŸ“Š systemVersion Ù…Ù† Ø§Ù„ÙÙŠØ±Ø¨ÙŠØ²: ${this.currentSystemVersion}`);
        }
        
        // âœ… Ø§Ù„Ø¢Ù† Ù†Ø­Ø¯Ø¯ userVersion Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ system version
        const storedVersion = localStorage.getItem('userUpdateVersion');
        if (storedVersion) {
          this.userVersion = parseInt(storedVersion);
        } else {
          // Ø£ÙˆÙ„ Ù…Ø±Ø© - Ù†Ø®Ù„ÙŠ userVersion = systemVersion
          this.userVersion = this.currentSystemVersion;
          localStorage.setItem('userUpdateVersion', this.userVersion.toString());
        }
        
        console.log(`ğŸ¯ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© - system: ${this.currentSystemVersion}, user: ${this.userVersion}`);
        
      } catch (error) {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥ØµØ¯Ø§Ø±:", error);
        this.userVersion = this.currentSystemVersion;
      }
    }

    createUpdateButton() {
      if (!document.getElementById('force-update-btn')) {
        const updateBtn = document.createElement('button');
        updateBtn.id = 'force-update-btn';
        updateBtn.innerHTML = 'ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±';
        updateBtn.style.cssText = `
          position: fixed;
          bottom: 20px;
          left: 20px;
          background: #ff9800;
          color: white;
          border: none;
          padding: 12px 20px;
          border-radius: 25px;
          font-weight: bold;
          display:none;
          cursor: pointer;
          z-index: 9999;
          box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
          display: none;
          opacity: 0;
          pointer-events: none;
          transform: scale(0.8);
          transition: all 0.3s ease;
        `;
        this.handleUserUpdate();
        
        document.body.appendChild(updateBtn);
        this.updateButton = updateBtn;
        console.log("ğŸš« Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù‚ÙÙˆÙ„ ØªÙ…Ø§Ù…Ø§Ù‹");
      }
    }

    async checkForUpdates() {
      try {
        console.log("ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø£Ø³Ø¹Ø§Ø±...");
        
        const updateDoc = await db.collection('system').doc('update').get();
        const updateData = updateDoc.data();
        
        if (updateData && updateData.updateVersion) {
          this.currentSystemVersion = updateData.updateVersion;
          
          console.log(`ğŸ“Š Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© - system: ${this.currentSystemVersion}, user: ${this.userVersion}`);
          
          // âœ… Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
          if (this.userVersion < this.currentSystemVersion) {
            this.showUpdateButton();
            console.log("ğŸŸ¡ ÙŠØ¸Ù‡Ø± Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« - ÙŠØ­ØªØ§Ø¬ ØªØ­Ø¯ÙŠØ«");
          } else {
            this.hideUpdateButton();
            console.log("ğŸš« Ù„Ø§ ÙŠØ¸Ù‡Ø± Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« - Ù…Ø­Ø¯Ø« Ø¨Ø§Ù„ÙØ¹Ù„");
          }
        } else {
          this.hideUpdateButton();
          console.log("ğŸš« Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø§Ù„ÙÙŠØ±Ø¨ÙŠØ²");
        }
      } catch (error) {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª:", error);
        this.hideUpdateButton();
      }
    }

    showUpdateButton() {
      if (this.updateButton) {
        this.updateButton.style.display = 'block';
        this.updateButton.style.opacity = '1';
        this.updateButton.style.pointerEvents = 'auto';
        this.updateButton.style.transform = 'scale(1)';
        console.log("âœ… ÙØªØ­ Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…");
      }
    }

    hideUpdateButton() {
      if (this.updateButton) {
        this.updateButton.style.display = 'none';
        this.updateButton.style.opacity = '0';
        this.updateButton.style.pointerEvents = 'none';
        this.updateButton.style.transform = 'scale(0.8)';
        console.log("ğŸš« Ø¥Ù‚ÙØ§Ù„ Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…");
      }
    }

    async handleUserUpdate() {
      console.log("âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±...");
      this.showLoading();
      
      try {
        // 1. Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°ÙƒÙŠ
        const success = await productManager.smartUpdate();
        
        if (success) {
          // 2. ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
          this.userVersion = this.currentSystemVersion;
          localStorage.setItem('userUpdateVersion', this.userVersion.toString());
          
          // 3. Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø²Ø±
          this.hideUpdateButton();
          
          // 4. Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
          this.showSuccessMessage();
          
          console.log(`ğŸ‰ ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°ÙƒÙŠ - userVersion Ø£ØµØ¨Ø­: ${this.userVersion}`);



          
        }
         else {
          throw new Error('ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«');
        }
        
      } catch (error) {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«:", error);
        this.showErrorMessage();
      } finally {
        this.hideLoading();
      }
    }

    showLoading() {
      if (this.updateButton) {
        this.updateButton.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±...';
        this.updateButton.disabled = true;
        this.updateButton.style.opacity = '0.7';
      }
    }

    hideLoading() {
      if (this.updateButton) {
        this.updateButton.innerHTML = 'ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±';
        this.updateButton.disabled = false;
        this.updateButton.style.opacity = '1';
      }
    }

    showSuccessMessage() {
      this.showNotification('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', '#4CAF50');
    }

    showErrorMessage() {
      this.showNotification('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', '#f44336');
    }

    showNotification(message, color) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed; 
        top: 20px; 
        left: 20px; 
        background: ${color}; 
        color: white; 
        padding: 15px 20px; 
        border-radius: 8px; 
        z-index: 10000; 
        animation: slideIn 0.3s ease, fadeOut 0.5s ease 2.5s forwards;
        font-weight: bold;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 3000);


      
    }
  }

  // =============================================
  // ğŸ¯ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
  // =============================================
  let productManager;
  let updateManager;

  document.addEventListener('DOMContentLoaded', async () => {
    console.log("ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...");

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    checkAuthState();
    updateCartCount();
    setupSearch();
    setupNavigation();
    loadOffers();

    // âœ… Ø¨Ø¯Ø¡ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø°ÙƒÙŠ
    productManager = new SmartProductManager();
    await productManager.initialize();

    // âœ… Ø¨Ø¯Ø¡ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø°ÙƒÙŠ
    updateManager = new UpdateManager();
    await updateManager.initialize();

    console.log("âœ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…");
  });

  // =============================================
  // ğŸª Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©
  // =============================================
  let selectedId, selectedName, selectedPrice;

  function openQuantityModal(id, name, price) {
    console.log(`ğŸ“¦ ÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ù„Ù„Ù…Ù†ØªØ¬: ${name}`);
    
    selectedId = id;
    selectedName = name;
    selectedPrice = price;
    
    createQuantityModalIfNotExists();
    
    const modalProductName = document.getElementById('modalProductName');
    const quantityInput = document.getElementById('quantityInput');
    const quantityModal = document.getElementById('quantityModal');
    
    if (modalProductName && quantityInput && quantityModal) {
      modalProductName.textContent = `Ø§Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ù…Ù†: ${name}`;
      quantityInput.value = "";
      quantityInput.focus();
      quantityModal.style.display = 'flex';
    } else {
      console.error('âŒ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
      addToCartDirect(id, name, price, 1);
    }
  }

  function createQuantityModalIfNotExists() {
    if (!document.getElementById('quantityModal')) {
      console.log("ğŸª Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„ÙƒÙ…ÙŠØ©...");
      
      const modalHTML = `
      <div id="quantityModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center;">
        <div style="background: #1a1a1a; padding: 2rem; border-radius: 15px; border: 3px solid yellow; text-align: center; min-width: 300px;">
          <h3 id="modalProductName" style="color: yellow; margin-bottom: 1rem;">Ø§Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©</h3>
          <input type="number" id="quantityInput" value="1" min="1" style="width: 100%; padding: 10px; font-size: 18px; text-align: center; border: 2px solid yellow; border-radius: 8px; background: #000; color: white; margin-bottom: 1rem;">
          <div style="display: flex; gap: 10px; justify-content: center;">
            <button onclick="confirmQuantity()" style="padding: 10px 20px; background: yellow; color: black; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">ØªØ£ÙƒÙŠØ¯</button>
            <button onclick="closeQuantityModal()" style="padding: 10px 20px; background: #666; color: white; border: none; border-radius: 8px; cursor: pointer;">Ø¥Ù„ØºØ§Ø¡</button>
          </div>
        </div>
      </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHTML);
    }
  }

  function closeQuantityModal() {
    const quantityModal = document.getElementById('quantityModal');
    if (quantityModal) {
      quantityModal.style.display = 'none';
    }
  }

  function confirmQuantity() {
    const quantityInput = document.getElementById('quantityInput');
    if (!quantityInput) return;
    
    const qty = parseInt(quantityInput.value);
    if (isNaN(qty) || qty <= 0) {
      alert("âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©");
      return;
    }

    console.log(`âœ… ØªØ£ÙƒÙŠØ¯ Ø¥Ø¶Ø§ÙØ© ${qty} Ù…Ù† ${selectedName}`);
    addToCart(selectedId, selectedName, selectedPrice, qty);
    closeQuantityModal();
  }

  // âœ… Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ø³Ù„Ø© (Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ¯Ø§Ù„)
  function addToCartDirect(productId, productName, productPrice, quantity = 1) {
    console.log(`ğŸ›’ Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø´Ø±Ø©: ${productName} Ã— ${quantity}`);
    addToCart(productId, productName, productPrice, quantity);
  }

  // =============================================
  // ğŸ›’ Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©
  // =============================================
  function addToCart(productId, productName, productPrice, quantity = 1) {
    console.log(`ğŸ›’ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¶Ø§ÙØ©: ${productName} Ã— ${quantity}`);
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    const user = JSON.parse(localStorage.getItem('user'));
    if (!user) {
      if (confirm('ğŸ”’ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ØŸ')) {
        window.location.href = 'login.html';
      }
      return;
    }

    console.log(`ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„: ${user.name}`);

    // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ Ù„Ù„ØªØ­Ù‚Ù‚
    if (productManager && productManager.initialLoadDone) {
      const productData = productManager.products.get(productId);
      
      if (productData) {
        console.log(`ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬:`, productData);
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„Ù…Ù†ØªØ¬
        if (productData.available === false) {
          showUnavailableNotification(productName);
          return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        if (!productData.unlimitedStock && productData.stock < quantity) {
          showStockNotification(productName, productData.stock);
          return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø·Ù„Ø¨
        if (productData.maxOrder > 0 && quantity > productData.maxOrder) {
          showMaxOrderNotification(productName, productData.maxOrder);
          return;
        }
      } else {
        console.log(`âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ù†ØªØ¬: ${productId}`);
      }
    }

    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ø³Ù„Ø©
    const existingItemIndex = cart.findIndex(item => item.id === productId);
    
    if (existingItemIndex !== -1) {
      // âœ… Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯ - ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ©
      cart[existingItemIndex].quantity += quantity;
      console.log(`ğŸ“ˆ ØªØ­Ø¯ÙŠØ« ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬: ${cart[existingItemIndex].quantity}`);
    } else {
      // âœ… Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ - Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
      cart.push({
        id: productId,
        name: productName,
        price: parseFloat(productPrice),
        quantity: quantity
      });
      console.log(`ğŸ†• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø³Ù„Ø©`);
    }

    // Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø© ÙÙŠ localStorage
    localStorage.setItem('cart', JSON.stringify(cart));
    console.log(`ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø©ØŒ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±: ${cart.length}`);
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
    updateCartCount();
    
    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯
    showSuccessNotification(productName, quantity);
  }

  // =============================================
  // ğŸ”” Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†
  // =============================================
  function showSuccessNotification(productName, quantity) {
    showNotification(productName, `ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­ - ${productName} Ã— ${quantity}`, "âœ…", "#4CAF50");
  }

  function showUnavailableNotification(productName) {
    showNotification(productName, "Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹", "â›”", "#dc3545");
  }

  function showStockNotification(productName, availableStock) {
    showNotification(productName, `Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©. Ø§Ù„Ù…ØªØ§Ø­: ${availableStock} ÙˆØ­Ø¯Ø©`, "âš ï¸", "#ff9800");
  }

  function showMaxOrderNotification(productName, maxOrder) {
    showNotification(productName, `ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø·Ù„Ø¨. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: ${maxOrder} ÙˆØ­Ø¯Ø©`, "ğŸš«", "#ff5722");
  }

  function showNotification(productName, message, icon, color) {
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed; top: 20px; right: 20px; background: ${color}; color: white; padding: 15px 20px; 
      border-radius: 8px; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.2); 
      animation: slideIn 0.3s ease, fadeOut 0.5s ease 2.5s forwards;
      display: flex; align-items: center; gap: 10px; max-width: 350px;
    `;
    
    notification.innerHTML = `
      <span style="font-size: 24px;">${icon}</span>
      <div>
        <strong>${productName}</strong>
        <div>${message}</div>
      </div>
    `;
    
    document.body.appendChild(notification);
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 3000);
  }

  // =============================================
  // ğŸ” Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªÙ†Ù‚Ù„
  // =============================================
  function setupSearch() {
    const searchInput = document.getElementById("searchInput");
    if (!searchInput) return;

    let searchTimeout;
    searchInput.addEventListener("input", function () {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        handleSearch(this.value.trim().toLowerCase());
      }, 300);
    });
  }

  function handleSearch(filter) {
    const productBoxes = document.querySelectorAll(".product-box");
    
    if (filter === '') {
      productBoxes.forEach(box => {
        box.style.display = "block";
        box.querySelectorAll(".product-item").forEach(item => {
          item.style.display = "flex";
          item.classList.remove("highlight");
        });
        box.querySelector("h2").classList.remove("highlight");
      });
      return;
    }

    productBoxes.forEach(box => {
      let hasMatch = false;
      const title = box.querySelector("h2").textContent.toLowerCase();
      const items = box.querySelectorAll(".product-item");

      if (title.includes(filter)) {
        box.style.display = "block";
        hasMatch = true;
        box.querySelector("h2").classList.add("highlight");
        items.forEach(item => item.style.display = "flex");
      } else {
        box.querySelector("h2").classList.remove("highlight");
      }

      items.forEach(item => {
        const text = item.textContent.toLowerCase();
        if (text.includes(filter)) {
          item.style.display = "flex";
          hasMatch = true;
          item.classList.add("highlight");
          box.style.display = "block";
        } else {
          item.style.display = "none";
          item.classList.remove("highlight");
        }
      });

      if (!hasMatch) box.style.display = "none";
    });
  }

  function setupNavigation() {
    const navToggle = document.querySelector('.nav-toggle');
    if (navToggle) {
      navToggle.addEventListener('click', toggleMenu);
    }
  }

  function toggleMenu() {
    const navLinks = document.querySelector('.nav-links');
    navLinks.classList.toggle('show');
  }

  function toggleUserMenu() {
    document.getElementById("user-menu").classList.toggle("show");
  }

  // =============================================
  // ğŸ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ø­Ø³Ù†
  // =============================================
  function loadOffers() {
    const container = document.getElementById("offersContainer");
    const track = document.getElementById("offersTrack");

    if (!container || !track) return;

    db.collection("offers").get().then(snapshot => {
      const offers = [];
      snapshot.forEach(doc => {
        const d = doc.data();
        if (d.name && d.price !== undefined) {
          offers.push({name: d.name, price: d.price});
        }
      });
      
      if (offers.length > 0) {
        renderOffers(offers);
      }
    }).catch(error => {
      console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶:", error);
    });

    function renderOffers(data) {
      track.innerHTML = "";
      container.style.display = "flex";

      data.forEach((o, i) => {
        const div = document.createElement("div");
        div.className = "offer-item" + (i === 0 ? " active" : "");
        div.innerHTML = `
          <span style="color: yellow;">ğŸ Ø¹Ø±Ø¶ Ø®Ø§Øµ:</span> 
          <strong>${o.name}</strong> - 
          <span style="color: #4CAF50;">${o.price} Ø¬</span>
        `;
        track.appendChild(div);
      });

      if (data.length > 1) {
        let currentIndex = 0;
        const items = track.querySelectorAll(".offer-item");
        
        setInterval(() => {
          items[currentIndex].classList.remove("active");
          currentIndex = (currentIndex + 1) % data.length;
          items[currentIndex].classList.add("active");
        }, 3000);
      }
    }
  }

  // =============================================
  // ğŸ” Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
  // =============================================
  function checkAuthState() {
    const user = JSON.parse(localStorage.getItem('user'));
    if (user) {
      document.getElementById('user-info').style.display = 'flex';
      document.getElementById('welcome-message').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name}`;
      document.getElementById('login-signup-buttons').style.display = 'none';
      showaDDmin();
      showaDDminclient();
    } else {
      document.getElementById('user-info').style.display = 'none';
      document.getElementById('login-signup-buttons').style.display = 'flex';
    }
  }

  function showaDDmin(){
    const user = JSON.parse(localStorage.getItem('user'));
    if(user && user.phone === "01021502941") {
      document.getElementById("admin1")?.classList.remove("admin");
      document.getElementById("admin2")?.classList.remove("admin");
      document.getElementById("admin3")?.classList.remove("admin");
    }
  }

  function showaDDminclient(){
    const user = JSON.parse(localStorage.getItem('user'));
    if(user && (user.phone === "01070533013" || user.phone === "01021502941")) {
      document.getElementById("admin4")?.classList.remove("admin");
    }
  }

  function logout() {
    localStorage.removeItem('user');
    checkAuthState();
    if (typeof Swal !== 'undefined') {
      Swal.fire({
        icon: 'success',
        title: 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­',
        showConfirmButton: false,
        timer: 2000
      });
    }
  }

  function checkPassword(e) {
    e.preventDefault();
    const pass = prompt("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
    if (pass === "12") {
      window.location.href = "dashboard.html";
    } else {
      alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    }
  }

  function checkPassword1(e) {
    e.preventDefault();
    const pass = prompt("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
    if (pass === "122") {
      window.location.href = "dashboardorder.html";
    } else {
      alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    }
  }

  // =============================================
  // ğŸ“¤ Ø±ÙØ¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„Ù‰ Firebase (Ù„Ù„Ø£Ø¯Ù…Ù†)
  // =============================================
  async function uploadAllProductsToFirebase() {
    const user = JSON.parse(localStorage.getItem('user'));
    if (!user || user.phone !== "01021502941") {
      alert("ğŸ”’ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø´Ø±Ù");
      return;
    }

    if (!confirm("âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù„Ø±ÙØ¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„Ù‰ Firebase.\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
      return;
    }

    try {
      const now = firebase.firestore.FieldValue.serverTimestamp();
      
      // Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† HTML
      const productItems = document.querySelectorAll('.product-item');
      let uploadedCount = 0;
      
      for (const item of productItems) {
        const nameSpan = item.querySelector('.product-name[data-product-id]');
        const priceSpan = item.querySelector('.price');
        
        if (nameSpan && priceSpan) {
          const productId = nameSpan.getAttribute('data-product-id');
          const productName = nameSpan.textContent.trim();
          const productPriceText = priceSpan.textContent.replace('Ø¬', '').trim();
          const productPrice = parseFloat(productPriceText);
          
          if (productId && productName && !isNaN(productPrice)) {
            await db.collection("products").doc(productId).set({
              name: productName,
              price: productPrice,
              cost: productPrice * 0.8, // Ø§ÙØªØ±Ø§Ø¶ÙŠ
              stock: 100,
              maxOrder: 0,
              available: true,
              unlimitedStock: false,
              lastUpdated: now,
              deleted: false
            }, { merge: true });
            
            uploadedCount++;
          }
        }
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù…
      await db.collection('system').doc('update').update({
        lastProductsUpdate: now,
        globalLastUpdate: now,
        updateVersion: firebase.firestore.FieldValue.increment(1)
      });
      
      alert(`âœ… ØªÙ… Ø±ÙØ¹ ${uploadedCount} Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Firebase`);
      
    } catch (error) {
      console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:", error);
      alert("âŒ ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª");
    }
  }

  // =============================================
  // ğŸ¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø´ÙŠØ¡ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
  // =============================================
  window.addEventListener('load', () => {
    console.log("ğŸ‰ Ø§Ù„ØµÙØ­Ø© Ù…Ø­Ù…Ù„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„");
  });

  // Ø¥Ø¶Ø§ÙØ© Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
  const style = document.createElement('style');
  style.textContent = `
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
  `;
  document.head.appendChild(style);
</script>

<!-- new product  -->
<h2 style="color:yellow; text-align:center; margin-top:40px;">ğŸ†• Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h2>
<div class="container" id="dynamicProducts"></div>
<script>
  const dynamicContainer = document.getElementById("dynamicProducts");

  function loadDynamicProducts() {
    const raw = localStorage.getItem("smart_products_cache");
    let products = [];

    if (raw) {
      try {
        const parsed = JSON.parse(raw);

        if (parsed.products && Array.isArray(parsed.products)) {
          products = parsed.products.map(item => {
            return {
              id: item[0],
              ...item[1]
            };
          });
        }
      } catch (e) {
        console.warn("Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© smart_products_cache:", e);
      }
    }

    const list = products.filter(p => !document.querySelector(`[data-product-id="${p.id}"]`));
    renderDynamic(list);
  }

  function renderDynamic(products) {
    dynamicContainer.innerHTML = "";

    if (!products || products.length === 0) {
      dynamicContainer.innerHTML = `
        <p style="color:#aaa; text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ø¢Ù†</p>
      `;
      return;
    }

    products.forEach(p => {
      const box = document.createElement("div");
      box.className = "product-box";

      box.innerHTML = `
        <h2>${p.name}</h2>
        <div class="product-item">
          <span class="product-name" data-product-id="${p.id}">
            ${p.name}
          </span>
          <span class="price">${p.price} Ø¬</span>
        </div>
      `;

      box.querySelector(".product-item").onclick = () => {
        addToCart(p.id, p.name, p.price);
      };

      dynamicContainer.appendChild(box);
    });
  }

  // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…
  setTimeout(() => {
    loadDynamicProducts();
  }, 2000);
</script>

</body>
</html>




