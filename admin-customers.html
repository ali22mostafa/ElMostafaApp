<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØµØ·ÙÙ‰</title>

  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #111;
      color: #fff;
      margin: 0;
      padding: 0;
    }

    .logo {
      display: block;
      margin: 10px auto;
      max-width: 220px;
      border-radius: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
    }

    h1 {
      color: yellow;
      text-align: center;
      margin-bottom: 30px;
    }

    .admin-panel {
      background-color: #222;
      border: 1px solid yellow;
      border-radius: 10px;
      padding: 20px;
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
      padding: 15px;
      background-color: #1a1a1a;
      border-radius: 8px;
    }

    .filter-group {
      flex: 1;
      min-width: 200px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      color: yellow;
    }

    input {
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: none;
      background-color: #333;
      color: white;
      font-size: 16px;
    }

    .refresh-btn {
      background-color: yellow;
      color: black;
      padding: 10px 15px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      width: 150px;
      margin-bottom: 15px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      table-layout: fixed;
    }

    th, td {
      padding: 12px;
      text-align: right;
      border-bottom: 1px solid #444;
      vertical-align: middle;
      word-wrap: break-word;
    }

    th {
      background-color: #333;
      color: yellow;
    }

    tr:hover {
      background-color: #2a2a2a;
    }

    .no-results {
      text-align: center;
      padding: 20px;
      color: #aaa;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: yellow;
    }

    .back-btn1 {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #0d47a1;
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      z-index: 1000;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      transition: background 0.3s ease;
    }

    .back-btn1:hover {
      background-color: #1565c0;
    }

    @media (max-width: 768px) {
      table {
        border: 0;
      }
      thead {
        display: none;
      }
      tr {
        display: block;
        margin-bottom: 15px;
        border: 1px solid #444;
        border-radius: 8px;
        padding: 10px;
        background: #1a1a1a;
      }
      td {
        display: block;
        text-align: right;
        padding: 8px 10px;
        border-bottom: 1px solid #333;
      }
      td:last-child {
        border-bottom: none;
      }
      td:nth-of-type(1)::before {
        content: "Ø§Ù„Ø§Ø³Ù…: ";
        font-weight: bold;
        color: yellow;
      }
      td:nth-of-type(2)::before {
        content: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: ";
        font-weight: bold;
        color: yellow;
      }
      td:nth-of-type(3)::before {
        content: "Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯: ";
        font-weight: bold;
        color: yellow;
      }
      td:nth-of-type(4)::before {
        content: "Ø§Ù„Ù…ÙˆÙ‚Ø¹: ";
        font-weight: bold;
        color: yellow;
      }
    }
  </style>
</head>

<body>

  <a href="index.html" class="back-btn1">â† Ø±Ø¬ÙˆØ¹</a>

  <header>
    <img src="img/zz.jpg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©" class="logo" />
  </header>

  <div class="container">
    <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h1>

    <div class="admin-panel">

      <!-- Ø²Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
      <button class="refresh-btn" onclick="refreshData()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>

      <div class="filters">
        <div class="filter-group">
          <label for="search-name">Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…:</label>
          <input type="text" id="search-name" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„..." oninput="filterCustomers()">
        </div>

        <div class="filter-group">
          <label for="search-phone">Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
          <input type="tel" id="search-phone" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ..." oninput="filterCustomers()">
        </div>
      </div>

      <div id="loading" class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡...</div>

      <table id="customers-table" style="display: none;">
        <thead>
          <tr>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
            <th>Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯</th>
            <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
          </tr>
        </thead>
        <tbody id="customers-list"></tbody>
      </table>

      <div id="no-results" class="no-results" style="display: none;">
        Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«
      </div>

    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    // ØªÙ‡ÙŠØ¦Ø© Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBKtxMNJ3n_YIsy671sbhlk8Qm1yt5uSB4",
      authDomain: "mostafa-products.firebaseapp.com",
      projectId: "mostafa-products",
      storageBucket: "mostafa-products.appspot.com",
      messagingSenderId: "841270845665",
      appId: "1:841270845665:web:f2f857112688b8b8be57a0",
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let customersCache = [];

    // =============== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ===================
    async function loadCustomers(forceUpdate = false) {
      document.getElementById("loading").style.display = "block";
      document.getElementById("customers-table").style.display = "none";
      document.getElementById("no-results").style.display = "none";

      if (!forceUpdate) {
        const cached = localStorage.getItem("customersData");
        if (cached) {
          customersCache = JSON.parse(cached);
          return renderCustomers(customersCache);
        }
      }

      const snapshot = await db.collection("users").get();
      customersCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      localStorage.setItem("customersData", JSON.stringify(customersCache));

      renderCustomers(customersCache);
    }

    // =============== Ø§Ù„Ø¨Ø­Ø« Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Read =================
    function filterCustomers() {
      const nameSearch = document.getElementById("search-name").value.trim().toLowerCase();
      const phoneSearch = document.getElementById("search-phone").value.trim();

      const filtered = customersCache.filter(c => {
        return (
          (!nameSearch || (c.name && c.name.toLowerCase().includes(nameSearch))) &&
          (!phoneSearch || (c.phone && c.phone.includes(phoneSearch)))
        );
      });

      renderCustomers(filtered);
    }

    // =============== Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ =================
    function renderCustomers(customers) {
      const tbody = document.getElementById("customers-list");
      tbody.innerHTML = "";

      if (customers.length === 0) {
        document.getElementById("loading").style.display = "none";
        document.getElementById("no-results").style.display = "block";
        return;
      }

      customers.forEach(c => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${c.name || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}</td>
          <td>${c.phone || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</td>
          <td>${c.password || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</td>
          <td>Ø¨Ø¯ÙˆÙ† Ù…ÙˆÙ‚Ø¹</td>
        `;

        tbody.appendChild(tr);
      });

      document.getElementById("loading").style.display = "none";
      document.getElementById("customers-table").style.display = "table";
    }

    // =============== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª =================
    function refreshData() {
      localStorage.removeItem("customersData");
      loadCustomers(true);
    }

    // =============== Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© =================
    window.onload = () => {
      loadCustomers();
    };
  </script>
<script>
  function refreshData() {
    const pass = prompt("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:");

    if (pass === "02") {
      alert("ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ âœ“ \nØ¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");
      localStorage.removeItem("customersData");
      loadCustomers(true);
    } else {
      alert("âŒ Ø¨Ø§Ø³ÙˆØ±Ø¯ ØºÙŠØ± ØµØ­ÙŠØ­!");
    }
  }
</script>

</body>
</html>
