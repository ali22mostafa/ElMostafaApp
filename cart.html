<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ - Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØµØ·ÙÙ‰</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #111;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    .logo {
      display: block;
      margin: 10px auto;
      max-width: 220px;
      border-radius: 20px;
      animation: bounceIn 1s ease-out, pulse 2s 2s ease-in-out infinite;
      transform-origin: center;
      transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .logo:hover {
      transform: scale(1.05) rotate(2deg);
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
    }
    h1 {
      color: yellow;
      text-align: center;
    }
    .cart-item {
      background-color: #222;
      border: 1px solid yellow;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .item-info {
      flex: 2;
    }
    .item-controls {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .quantity-controls {
      display: flex;
      align-items: center;
    }
    .quantity-btn {
      background-color: yellow;
      color: black;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      font-weight: bold;
      cursor: pointer;
      margin: 0 5px;
    }
    .quantity-btn:disabled {
      background-color: #666;
      color: #999;
      cursor: not-allowed;
    }
    .quantity-input {
      width: 50px;
      height: 30px;
      text-align: center;
      background-color: #333;
      color: white;
      border: 1px solid yellow;
      border-radius: 5px;
      margin: 0 5px;
    }
    .remove-btn {
      background-color: #ff3333;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .total-section {
      background-color: #333;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      text-align: center;
    }
    .checkout-btn {
      background-color: yellow;
      color: black;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-weight: bold;
      font-size: 18px;
      margin-top: 20px;
      cursor: pointer;
      width: 100%;
    }
    .empty-cart {
      text-align: center;
      padding: 50px;
      color: #aaa;
    }

    .back-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #0d47a1;
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      z-index: 1000;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      transition: background 0.3s ease;
    }

    .back-btn:hover {
      background-color: #1565c0;
    }
    
    .stock-info {
      color: #4CAF50;
      font-size: 12px;
      margin-top: 5px;
    }
    
    .max-order-info {
      color: #ff9800;
      font-size: 12px;
      margin-top: 5px;
    }
    
    .error-message {
      background-color: #ff3333;
      color: white;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      text-align: center;
      display: none;
    }
    
    .success-message {
      background-color: #4CAF50;
      color: white;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      text-align: center;
      display: none;
    }
    
    .warning-message {
      background-color: #ff9800;
      color: white;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      text-align: center;
    }
    
    .cache-status {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: #4CAF50;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
      z-index: 1000;
      display: none !important;
    }
    
    .no-firebase-warning {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 10px 15px;
      border-radius: 10px;
      margin: 15px 0;
      text-align: center;
      font-weight: bold;
      border: 2px solid #fff;
      animation: pulseWarning 2s infinite;
    }
    
    @keyframes bounceIn {
      0% { opacity: 0; transform: scale(0.3) rotate(-10deg); }
      50% { opacity: 1; transform: scale(1.1) rotate(5deg); }
      70% { transform: scale(0.95) rotate(-2deg); }
      100% { transform: scale(1) rotate(0deg); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 0, 0.7); }
      50% { transform: scale(1.05); }
      70% { box-shadow: 0 0 0 15px rgba(255, 255, 0, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 0, 0); }
    }
    
    @keyframes pulseWarning {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    
    .product-unavailable {
      opacity: 0.6;
      border-color: #ff3333 !important;
    }
    
    .product-unavailable h3 {
      color: #ff3333 !important;
    }
    
    .product-unavailable-message {
      color: #ff9800;
      font-size: 12px;
      margin-top: 5px;
    }
  </style>
  <style>
    input,
    textarea,
    select {
      font-size: 16px;
    }

     #error-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff3cd;
      color: #856404;
      padding: 15px 20px;
      border-radius: 8px;
      z-index: 9999;
      display: none;
      font-size: 20px !important;
      text-align: center;
      max-width: 90%;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9998;
      color: yellow;
      font-size: 20px;
      flex-direction: column;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #333;
      border-top: 5px solid yellow;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <header>
    <img src="img/zz.jpg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©" class="logo" />
    <a href="index.html" class="back-btn">â† Ø±Ø¬ÙˆØ¹</a>
  </header>

  <div class="container">
    <h1>Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h1>
    
    <div style="display: none;" class="no-firebase-warning">
      âš¡ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ - Ù„Ø§ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±
    </div>
    
    <div id="error-message" class="error-message"></div>
    <div id="success-message" class="success-message"></div>
    
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
      <div class="loading-spinner"></div>
      <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù„Ø©...</p>
    </div>
    
    <div id="cart-items-container">
      <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù‡Ù†Ø§ Ø¹Ø¨Ø± JavaScript -->
    </div>
    <div id="empty-cart-message" class="empty-cart" style="display: none;">
      <p>Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ ÙØ§Ø±ØºØ©</p>
      <a href="index.html" style="color: yellow;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø±</a>
    </div>
    <div id="total-section" class="total-section" style="display: none;">
      <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="cart-total">0</span> Ø¬Ù†ÙŠÙ‡Ø§Ù‹</h3>
      <button class="checkout-btn" onclick="cartManager.proceedToCheckout()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
    </div>
  </div>

  <div class="cache-status" id="cache-status">âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹</div>

  <script>
    // =============================================
    // ğŸš€ Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠ Ø§Ù„Ø°ÙƒÙŠ - ÙŠØ¯Ø¹Ù… Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠÙ† Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆØ§Ù„Ø¬Ø¯ÙŠØ¯
    // =============================================
    
    class CartManager {
      constructor() {
        this.cart = JSON.parse(localStorage.getItem('cart')) || [];
        this.productsCache = new Map();
        this.cacheTimestamp = 0;
        this.cacheSource = 'none';
        this.init();
      }
      
      async init() {
        console.log('ğŸš€ Ø¨Ø¯Ø¡ Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠ Ø§Ù„Ø°ÙƒÙŠ...');
        this.showLoading(true);
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©
        await this.loadProductsFromAllSources();
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø©
        this.displayCart();
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ø´
        this.updateCacheStatus();
        
        this.showLoading(false);
        console.log('âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ù„Ø© Ø¬Ø§Ù‡Ø² - Ù…ØµØ¯Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', this.cacheSource);
      }
      
      // ğŸ” ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…Ø­Ù„ÙŠØ©
      async loadProductsFromAllSources() {
        console.log('ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹...');
        
        // 1. Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (smart_products_cache)
        if (await this.tryLoadSmartCache()) {
          return;
        }
        
        // 2. Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ… (products_cache)
        if (await this.tryLoadOldCache()) {
          return;
        }
        
        // 3. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ù† HTML Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø§ ÙŠØ²Ø§Ù„ Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ ÙÙŠ Ø§Ù„ØµÙØ­Ø©
        if (await this.tryExtractFromPage()) {
          return;
        }
        
        // 4. ÙØ´Ù„ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
        console.warn('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª');
        this.cacheSource = 'none';
        this.productsCache = new Map();
      }
      
      // ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯
      async tryLoadSmartCache() {
        try {
          const cacheData = localStorage.getItem('smart_products_cache');
          if (!cacheData) {
            console.log('ğŸ“­ smart_products_cache ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            return false;
          }
          
          const parsed = JSON.parse(cacheData);
          
          if (!parsed.products || !Array.isArray(parsed.products)) {
            console.warn('âš ï¸ smart_products_cache ØªØ§Ù„Ù Ø£Ùˆ ØºÙŠØ± ØµØ§Ù„Ø­');
            return false;
          }
          
          // Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ: products Ù‡ÙŠ array of [key, value]
          this.productsCache = new Map(parsed.products);
          this.cacheTimestamp = parsed.timestamp || Date.now();
          this.cacheSource = 'smart';
          
          console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${this.productsCache.size} Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ`);
          return true;
          
        } catch (error) {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ smart_products_cache:', error);
          return false;
        }
      }
      
      // ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…
      async tryLoadOldCache() {
        try {
          const cacheData = localStorage.getItem('products_cache');
          if (!cacheData) {
            console.log('ğŸ“­ products_cache ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            return false;
          }
          
          const parsed = JSON.parse(cacheData);
          
          // Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…: data Ø£Ùˆ products Ù‡ÙŠ array of [key, value]
          const productsArray = parsed.data || parsed.products || [];
          
          if (!Array.isArray(productsArray) || productsArray.length === 0) {
            console.warn('âš ï¸ products_cache ØªØ§Ù„Ù Ø£Ùˆ ÙØ§Ø±Øº');
            return false;
          }
          
          this.productsCache = new Map(productsArray);
          this.cacheTimestamp = parsed.timestamp || Date.now();
          this.cacheSource = 'old';
          
          console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${this.productsCache.size} Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…`);
          return true;
          
        } catch (error) {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ products_cache:', error);
          return false;
        }
      }
      
      // ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØµÙØ­Ø© (backup)
      async tryExtractFromPage() {
        console.log('ğŸ” Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØµÙØ­Ø©...');
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† localStorage Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        try {
          // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ÙŠØ©
          const initialProducts = this.extractFromStaticHTML();
          if (initialProducts.size > 0) {
            this.productsCache = initialProducts;
            this.cacheTimestamp = Date.now();
            this.cacheSource = 'static';
            
            console.log(`âœ… ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ ${this.productsCache.size} Ù…Ù†ØªØ¬ Ù…Ù† HTML`);
            return true;
          }
        } catch (error) {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† HTML:', error);
        }
        
        return false;
      }
      
      // ğŸ“„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† HTML Ø§Ù„Ø«Ø§Ø¨Øª (Ù…Ù†ØªØ¬ Ø§Ø­ØªÙŠØ§Ø·ÙŠ)
      extractFromStaticHTML() {
        const products = new Map();
        
        // Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
        const basicProducts = [
          {
            id: 'mustafa-minced-3kg',
            name: 'Ù…ÙØ±ÙˆÙ… Ø§Ù„Ù…ØµØ·ÙÙ‰ 3 Ùƒ',
            price: 550,
            available: true,
            stock: 100
          },
          {
            id: 'mustafa-minced-1kg',
            name: 'Ù…ÙØ±ÙˆÙ… Ø§Ù„Ù…ØµØ·ÙÙŠ 1 Ùƒ',
            price: 193,
            available: true,
            stock: 100
          },
          {
            id: 'mustafa-minced-400g',
            name: 'Ù…ÙØ±ÙˆÙ… Ø§Ù„Ù…ØµØ·ÙÙŠ 400',
            price: 79.5,
            available: true,
            stock: 100
          },
          {
            id: 'mustafa-cubes-5kg',
            name: 'Ù„Ø­Ù… Ù…ÙƒØ¹Ø¨Ø§Øª Ø§Ù„Ù…ØµØ·ÙÙŠ 5 Ùƒ',
            price: 1135,
            available: true,
            stock: 50
          },
          {
            id: 'hamd-white-1kg',
            name: 'Ø¬Ø¨Ù†Ù‡ Ø§Ù„Ø­Ù…Ø¯ Ø£Ø¨ÙŠØ¶ 1 Ùƒ',
            price: 123,
            available: true,
            stock: 200
          },
          {
            id: 'basma-molokhia',
            name: 'Ù…Ù„ÙˆØ®ÙŠÙ‡ Ø¨Ø³Ù…Ù‡',
            price: 14.5,
            available: true,
            stock: 500,
            maxOrder: 10
          }
        ];
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        basicProducts.forEach(product => {
          products.set(product.id, product);
        });
        
        return products;
      }
      
      // ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„ÙƒØ§Ø´ (Ø¨Ø¯Ø¹Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø±)
      getProductFromCache(productId) {
        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„
        if (this.productsCache && this.productsCache.has(productId)) {
          return this.productsCache.get(productId);
        }
        
        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ù…ØµØ§Ø¯Ø± localStorage
        const product = this.searchInAllCaches(productId);
        if (product) {
          // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ
          this.productsCache.set(productId, product);
          return product;
        }
        
        console.warn(`âš ï¸ Ø§Ù„Ù…Ù†ØªØ¬ ${productId} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø£ÙŠ ÙƒØ§Ø´`);
        return null;
      }
      
      // ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ù…ØµØ§Ø¯Ø± Ø§Ù„ÙƒØ§Ø´
      searchInAllCaches(productId) {
        // 1. smart_products_cache
        const smartCache = localStorage.getItem('smart_products_cache');
        if (smartCache) {
          try {
            const parsed = JSON.parse(smartCache);
            const smartMap = new Map(parsed.products || []);
            if (smartMap.has(productId)) {
              console.log(`âœ… ÙˆØ¬Ø¯ ${productId} ÙÙŠ smart_products_cache`);
              return smartMap.get(productId);
            }
          } catch (e) {
            console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© smart_products_cache:', e);
          }
        }
        
        // 2. products_cache Ø§Ù„Ù‚Ø¯ÙŠÙ…
        const oldCache = localStorage.getItem('products_cache');
        if (oldCache) {
          try {
            const parsed = JSON.parse(oldCache);
            const oldArray = parsed.data || parsed.products || [];
            const oldMap = new Map(oldArray);
            if (oldMap.has(productId)) {
              console.log(`âœ… ÙˆØ¬Ø¯ ${productId} ÙÙŠ products_cache`);
              return oldMap.get(productId);
            }
          } catch (e) {
            console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© products_cache:', e);
          }
        }
        
        // 3. Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ù† extractFromStaticHTML
        const staticProducts = this.extractFromStaticHTML();
        if (staticProducts.has(productId)) {
          console.log(`âœ… ÙˆØ¬Ø¯ ${productId} ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©`);
          return staticProducts.get(productId);
        }
        
        return null;
      }
      
      // ğŸ“Š ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ø´
      updateCacheStatus() {
        const statusEl = document.getElementById('cache-status');
        if (!statusEl) return;
        
        const cacheNames = {
          'smart': 'Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ',
          'old': 'Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…', 
          'static': 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©',
          'none': 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª'
        };
        
        const cacheColors = {
          'smart': '#4CAF50',
          'old': '#2196F3',
          'static': '#FF9800',
          'none': '#FF5722'
        };
        
        const cacheAge = Date.now() - this.cacheTimestamp;
        const minutes = Math.floor(cacheAge / 60000);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);
        
        let ageText = '';
        if (minutes < 1) ageText = 'Ø§Ù„Ø¢Ù†';
        else if (minutes < 60) ageText = `${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
        else if (hours < 24) ageText = `${hours} Ø³Ø§Ø¹Ø©`;
        else ageText = `${days} ÙŠÙˆÙ…`;
        
        const cacheName = cacheNames[this.cacheSource] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
        const productCount = this.productsCache.size;
        
        statusEl.textContent = `ğŸ“Š ${cacheName} | ${productCount} Ù…Ù†ØªØ¬ | ${ageText}`;
        statusEl.style.color = cacheColors[this.cacheSource] || '#FFFFFF';
      }
      
      // ğŸ“ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø©
      displayCart() {
        const cartItemsContainer = document.getElementById('cart-items-container');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const totalSection = document.getElementById('total-section');
        
        if (this.cart.length === 0) {
          cartItemsContainer.innerHTML = '';
          emptyCartMessage.style.display = 'block';
          totalSection.style.display = 'none';
          this.showMessage('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©', 'info');
          return;
        }
        
        emptyCartMessage.style.display = 'none';
        totalSection.style.display = 'block';
        
        cartItemsContainer.innerHTML = '';
        let total = 0;
        let hasErrors = false;
        let allItemsValid = true;
        
        this.cart.forEach((item, index) => {
          const productData = this.getProductFromCache(item.id);
          const validation = this.validateProduct(item.id, 0, item.quantity);
          
          const isUnavailable = !validation.valid;
          if (isUnavailable) {
            hasErrors = true;
            allItemsValid = false;
          }
          
          const itemElement = document.createElement('div');
          itemElement.className = `cart-item ${isUnavailable ? 'product-unavailable' : ''}`;
          
          itemElement.innerHTML = `
            <div class="item-info">
              <h3>${item.name}</h3>
              <p>Ø§Ù„Ø³Ø¹Ø±: ${item.price} Ø¬</p>
              <p>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${(item.price * item.quantity).toFixed(2)} Ø¬</p>
              
              ${productData && productData.stock !== undefined ? 
                `<div class="stock-info">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${productData.stock} ÙˆØ­Ø¯Ø©</div>` : ''}
              
              ${productData && productData.maxOrder ? 
                `<div class="max-order-info">ğŸ“Š Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: ${productData.maxOrder} ÙˆØ­Ø¯Ø©</div>` : ''}
              
              ${!validation.valid ? 
                `<div class="product-unavailable-message">${validation.message}</div>` : ''}
            </div>
            
            <div class="item-controls">
              <div class="quantity-controls">
                <button class="quantity-btn" 
                        onclick="cartManager.updateQuantity(${index}, -1)"
                        ${item.quantity <= 1 ? 'disabled' : ''}
                        ${isUnavailable ? 'disabled' : ''}>-</button>
                
                <input type="number" class="quantity-input" 
                       value="${item.quantity}" 
                       min="1" 
                       onchange="cartManager.updateQuantityDirect(${index}, this.value)" 
                       oninput="cartManager.validateInput(this)"
                       ${isUnavailable ? 'disabled' : ''}>
                
                <button class="quantity-btn" 
                        onclick="cartManager.updateQuantity(${index}, 1)"
                        ${isUnavailable ? 'disabled' : ''}>+</button>
              </div>
              
              <button class="remove-btn" onclick="cartManager.removeItem(${index})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
            </div>
          `;
          
          cartItemsContainer.appendChild(itemElement);
          total += parseFloat(item.price) * item.quantity;
        });
        
        document.getElementById('cart-total').textContent = total.toFixed(2);
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø²Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯
        const checkoutBtn = document.querySelector('.checkout-btn');
        if (checkoutBtn) {
          if (!allItemsValid) {
            checkoutBtn.disabled = true;
            checkoutBtn.style.opacity = '0.5';
            checkoutBtn.style.cursor = 'not-allowed';
            checkoutBtn.textContent = 'âš ï¸ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ù…ØªØ§Ø­Ø©';
          } else {
            checkoutBtn.disabled = false;
            checkoutBtn.style.opacity = '1';
            checkoutBtn.style.cursor = 'pointer';
            checkoutBtn.textContent = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨';
          }
        }
        
        this.updateCacheStatus();
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£Ø®Ø·Ø§Ø¡ØŒ Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø©
        if (hasErrors) {
          this.showMessage('âš ï¸ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø£Ùˆ Ø¨Ù‡Ø§ Ù…Ø´Ø§ÙƒÙ„', 'warning');
        }
      }
      
      // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬ (Ù…Ø­Ù„ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)
      validateProduct(productId, requestedQuantity, currentQuantity = 0) {
        const productData = this.getProductFromCache(productId);
        
        if (!productData) {
          return {
            valid: false,
            message: 'Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©',
            stock: 0,
            maxOrder: 0
          };
        }
        
        const finalQuantity = currentQuantity + requestedQuantity;
        
        // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„Ù…Ù†ØªØ¬
        if (productData.available === false) {
          return {
            valid: false,
            message: 'â›” Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹',
            stock: 0,
            maxOrder: 0
          };
        }
        
        // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø·Ù„Ø¨
        if (productData.maxOrder > 0 && finalQuantity > productData.maxOrder) {
          return {
            valid: false,
            message: `ğŸš« Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø·Ù„Ø¨ Ù‡Ùˆ ${productData.maxOrder} ÙˆØ­Ø¯Ø©`,
            stock: productData.stock || 0,
            maxOrder: productData.maxOrder
          };
        }
        
        // 3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        if (!productData.unlimitedStock && productData.stock !== undefined) {
          if (finalQuantity > productData.stock) {
            return {
              valid: false,
              message: `âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø®Ø²ÙˆÙ† ÙƒØ§ÙÙŠ. Ø§Ù„Ù…ØªØ§Ø­: ${productData.stock} ÙˆØ­Ø¯Ø©`,
              stock: productData.stock,
              maxOrder: productData.maxOrder || 0
            };
          }
        }
        
        return {
          valid: true,
          message: '',
          stock: productData.stock || 0,
          maxOrder: productData.maxOrder || 0,
          price: productData.price,
          name: productData.name
        };
      }
      
      // ğŸ”¢ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ©
      updateQuantity(index, change) {
        const item = this.cart[index];
        if (!item) return;
        
        const newQuantity = item.quantity + change;
        
        if (newQuantity < 1) {
          this.removeItem(index);
          return;
        }
        
        const validation = this.validateProduct(item.id, change, item.quantity);
        
        if (!validation.valid) {
          this.showMessage(validation.message, 'error');
          return;
        }
        
        this.cart[index].quantity = newQuantity;
        this.saveCart();
        this.displayCart();
        
        const message = change > 0 
          ? `âœ… ØªÙ… Ø²ÙŠØ§Ø¯Ø© ${item.name} Ø¥Ù„Ù‰ ${newQuantity} ÙˆØ­Ø¯Ø©`
          : `âœ… ØªÙ… ØªÙ‚Ù„ÙŠÙ„ ${item.name} Ø¥Ù„Ù‰ ${newQuantity} ÙˆØ­Ø¯Ø©`;
          
        this.showMessage(message, 'success');
      }
      
      // âŒ¨ï¸ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ© ÙŠØ¯ÙˆÙŠØ§Ù‹
      updateQuantityDirect(index, newQuantity) {
        newQuantity = parseInt(newQuantity);
        const item = this.cart[index];
        
        if (!item || isNaN(newQuantity) || newQuantity < 1) {
          if (newQuantity < 1 && item) {
            this.removeItem(index);
          }
          return;
        }
        
        const change = newQuantity - item.quantity;
        const validation = this.validateProduct(item.id, change, item.quantity);
        
        if (!validation.valid) {
          this.showMessage(validation.message, 'error');
          const inputs = document.querySelectorAll('.quantity-input');
          if (inputs[index]) inputs[index].value = item.quantity;
          return;
        }
        
        this.cart[index].quantity = newQuantity;
        this.saveCart();
        this.displayCart();
        this.showMessage(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ…ÙŠØ© ${item.name} Ø¥Ù„Ù‰ ${newQuantity}`, 'success');
      }
      
      // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
      validateInput(input) {
        if (input.value < 1) {
          input.value = 1;
        }
      }
      
      // ğŸ—‘ï¸ Ø¥Ø²Ø§Ù„Ø© Ø¹Ù†ØµØ±
      removeItem(index) {
        const item = this.cart[index];
        if (!item) return;
        
        if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù "${item.name}" Ù…Ù† Ø§Ù„Ø³Ù„Ø©ØŸ`)) {
          this.cart.splice(index, 1);
          this.saveCart();
          this.displayCart();
          this.showMessage(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù ${item.name} Ù…Ù† Ø§Ù„Ø³Ù„Ø©`, 'success');
        }
      }
      
      // ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø©
      saveCart() {
        localStorage.setItem('cart', JSON.stringify(this.cart));
        console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø© ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ');
      }
      
      // ğŸ“Š Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù…Ù„ÙˆØ®ÙŠØ© Ø¨Ø³Ù…Ø©)
      validateRequiredProducts() {
        const requiredProduct = 'basma-molokhia';
        const complementaryProducts = [
          'basma-taro', 'basma-beans', 'basma-mixed-veg', 
          'basma-peas-carrots', 'basma-peas-plain', 'basma-veg-soup',
          'basma-okra-premium', 'basma-okra-zero', 'basma-okra-extra', 
          'basma-okra-grapes', 'basma-okra-strewBerry', 'basma-spinach'
        ];
        
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ù„ÙˆØ®ÙŠØ© ÙÙŠ Ø§Ù„Ø³Ù„Ø©
        const molokhiaItem = this.cart.find(item => item.id === requiredProduct);
        
        // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ù„ÙˆØ®ÙŠØ©ØŒ ÙŠÙ…ÙƒÙ† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
        if (!molokhiaItem) {
          return { isValid: true, message: "" };
        }
        
        const molokhiaQuantity = molokhiaItem.quantity;
        
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙƒÙ…ÙŠÙ„ÙŠØ© ÙÙŠ Ø§Ù„Ø³Ù„Ø©
        const complementaryItems = this.cart.filter(item => 
          complementaryProducts.includes(item.id) && item.id !== requiredProduct
        );
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù†ØªØ¬ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙƒÙ…ÙŠÙ„ÙŠØ©
        if (complementaryItems.length === 0) {
          return { 
            isValid: false, 
            message: 'âš ï¸ Ù„Ù‚Ø¯ Ø·Ù„Ø¨Øª Ù…Ù„ÙˆØ®ÙŠØ© Ø¨Ø³Ù…Ø© ÙÙ‚Ø·. ÙŠØ¬Ø¨ Ø·Ù„Ø¨ Ø£ÙŠ Ù…Ù†ØªØ¬ Ø¢Ø®Ø± Ù…Ù† Ø®Ø¶Ø±ÙˆØ§Øª Ø¨Ø³Ù…Ø© Ø¨Ù†ÙØ³ ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù„ÙˆØ®ÙŠØ© Ø£Ùˆ Ø²ÙŠØ§Ø¯Ø©'
          };
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒÙ…ÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙƒÙ…ÙŠÙ„ÙŠØ© >= ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù„ÙˆØ®ÙŠØ©
        const totalComplementaryQuantity = complementaryItems.reduce((total, item) => {
          return total + item.quantity;
        }, 0);
        
        if (totalComplementaryQuantity < molokhiaQuantity) {
          return { 
            isValid: false, 
            message: 'âš ï¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒÙ…ÙŠØ© Ø®Ø¶Ø±ÙˆØ§Øª Ø¨Ø³Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ø³Ø§ÙˆÙŠ Ø£Ùˆ Ø£ÙƒØ¨Ø± Ù…Ù† ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù„ÙˆØ®ÙŠØ©'
          };
        }
        
        return { isValid: true, message: "" };
      }
      
      // ğŸ›’ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¯ÙØ¹
      proceedToCheckout() {
        // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user) {
          this.showMessage('ğŸ”’ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨', 'error');
          setTimeout(() => window.location.href = 'login.html', 2000);
          return;
        }
        
        // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù†ØªØ¬Ø§Øª
        if (this.cart.length === 0) {
          this.showMessage('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©', 'error');
          return;
        }
        
        // 3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        const requiredValidation = this.validateRequiredProducts();
        if (!requiredValidation.isValid) {
          this.showMessage(requiredValidation.message, 'error');
          return;
        }
        
        // 4. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        let allProductsValid = true;
        let errorMessages = [];
        
        this.cart.forEach(item => {
          const validation = this.validateProduct(item.id, 0, item.quantity);
          if (!validation.valid) {
            allProductsValid = false;
            errorMessages.push(`${item.name}: ${validation.message}`);
          }
        });
        
        if (!allProductsValid) {
          this.showMessage(`ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:<br>${errorMessages.join('<br>')}`, 'error');
          return;
        }
        
        // 5. ÙƒÙ„ Ø´ÙŠØ¡ Ø¬ÙŠØ¯ØŒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¯ÙØ¹
        console.log('âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØµØ§Ù„Ø­Ø©ØŒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¯ÙØ¹');
        window.location.href = 'checkout.html';
      }
      
      // ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©
      clearCart() {
        if (this.cart.length === 0) return;
        
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ')) {
          this.cart = [];
          this.saveCart();
          this.displayCart();
          this.showMessage('ğŸ§¹ ØªÙ… Ù…Ø³Ø­ Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„', 'success');
        }
      }
      
      // â³ Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
      showLoading(show) {
        const loadingEl = document.getElementById('loading-overlay');
        if (loadingEl) {
          loadingEl.style.display = show ? 'flex' : 'none';
        }
      }
      
      // ğŸ”” Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†
      showMessage(message, type = 'info') {
        // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø£ÙˆÙ„Ø§Ù‹
        const errorEl = document.getElementById('error-message');
        const successEl = document.getElementById('success-message');
        
        if (errorEl) errorEl.style.display = 'none';
        if (successEl) successEl.style.display = 'none';
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
        let targetEl = null;
        let displayTime = 3000;
        
        switch(type) {
          case 'error':
            targetEl = errorEl;
            displayTime = 5000;
            console.error('âŒ ' + message.replace(/<br>/g, ' '));
            break;
          case 'success':
            targetEl = successEl;
            displayTime = 3000;
            console.log('âœ… ' + message);
            break;
          case 'warning':
            targetEl = errorEl;
            if (targetEl) {
              targetEl.style.background = '#ff9800';
              targetEl.style.color = '#000';
            }
            displayTime = 4000;
            console.warn('âš ï¸ ' + message);
            break;
          case 'info':
            targetEl = successEl;
            if (targetEl) {
              targetEl.style.background = '#2196F3';
            }
            displayTime = 2000;
            console.log('â„¹ï¸ ' + message);
            break;
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        if (targetEl) {
          if (type === 'error') {
            targetEl.innerHTML = message;
          } else {
            targetEl.textContent = message;
          }
          targetEl.style.display = 'block';
          
          // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
          setTimeout(() => {
            if (targetEl) {
              targetEl.style.display = 'none';
              // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ù†Ù…Ø§Ø·
              if (type === 'error' || type === 'warning') {
                targetEl.style.background = '';
                targetEl.style.color = '';
              }
            }
          }, displayTime);
        }
      }
      
      // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ (Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…)
      showError(message) {
        this.showMessage(message, 'error');
      }
      
      // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ (Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…)
      showSuccess(message) {
        this.showMessage(message, 'success');
      }
    }
    
    // =============================================
    // ğŸ¯ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    // =============================================
    
    let cartManager;
    
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ø©...');
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¯ÙŠØ± Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø°ÙƒÙŠ
      cartManager = new CartManager();
      
      // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©
      addClearCartButton();
      
      console.log('âœ… ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ© Ø¬Ø§Ù‡Ø²Ø©');
    });
    
    // ğŸ§¹ Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©
    function addClearCartButton() {
      const clearBtn = document.createElement('button');
      clearBtn.innerHTML = 'ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©';
      clearBtn.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        display: none;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(255, 65, 108, 0.3);
        transition: all 0.3s ease;
      `;
      clearBtn.onmouseover = () => clearBtn.style.transform = 'scale(1.05)';
      clearBtn.onmouseout = () => clearBtn.style.transform = 'scale(1)';
      clearBtn.onclick = () => cartManager.clearCart();
      
      document.body.appendChild(clearBtn);
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø³Ù„Ø© ØºÙŠØ± ÙØ§Ø±ØºØ©
      const checkCart = () => {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        clearBtn.style.display = cart.length > 0 ? 'block' : 'none';
      };
      
      checkCart();
      setInterval(checkCart, 1000);
    }
    
    // =============================================
    // ğŸ“± Ø¬Ø¹Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
    // =============================================
    
    window.cartManager = cartManager;
    
  </script>
</body>
</html>
