<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ - Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØµØ·ÙÙ‰</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #111;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    .logo {
      display: block;
      margin: 10px auto;
      max-width: 220px;
      border-radius: 20px;
      animation: bounceIn 1s ease-out, pulse 2s 2s ease-in-out infinite;
      transform-origin: center;
      transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .logo:hover {
      transform: scale(1.05) rotate(2deg);
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
    }
    h1 {
      color: yellow;
      text-align: center;
    }
    .cart-item {
      background-color: #222;
      border: 1px solid yellow;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .item-info {
      flex: 2;
    }
    .item-controls {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .quantity-controls {
      display: flex;
      align-items: center;
    }
    .quantity-btn {
      background-color: yellow;
      color: black;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      font-weight: bold;
      cursor: pointer;
      margin: 0 5px;
    }
    .quantity-btn:disabled {
      background-color: #666;
      color: #999;
      cursor: not-allowed;
    }
    .quantity-input {
      width: 50px;
      height: 30px;
      text-align: center;
      background-color: #333;
      color: white;
      border: 1px solid yellow;
      border-radius: 5px;
      margin: 0 5px;
    }
    .remove-btn {
      background-color: #ff3333;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .total-section {
      background-color: #333;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      text-align: center;
    }
    .checkout-btn {
      background-color: yellow;
      color: black;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-weight: bold;
      font-size: 18px;
      margin-top: 20px;
      cursor: pointer;
      width: 100%;
    }
    .empty-cart {
      text-align: center;
      padding: 50px;
      color: #aaa;
    }

    .back-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #0d47a1;
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      z-index: 1000;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      transition: background 0.3s ease;
    }

    .back-btn:hover {
      background-color: #1565c0;
    }
    
    .stock-info {
      color: #4CAF50;
      font-size: 12px;
      margin-top: 5px;
    }
    
    .max-order-info {
      color: #ff9800;
      font-size: 12px;
      margin-top: 5px;
    }
    
    .error-message {
      background-color: #ff3333;
      color: white;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      text-align: center;
      display: none;
    }
    
    .success-message {
      background-color: #4CAF50;
      color: white;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      text-align: center;
      display: none;
    }
    
    .warning-message {
      background-color: #ff9800;
      color: white;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      text-align: center;
    }
    
    .cache-status {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: #4CAF50;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
      z-index: 1000;
      display: none !important;
    }
    
    .no-firebase-warning {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 10px 15px;
      border-radius: 10px;
      margin: 15px 0;
      text-align: center;
      font-weight: bold;
      border: 2px solid #fff;
      animation: pulseWarning 2s infinite;
    }
    
    @keyframes bounceIn {
      0% { opacity: 0; transform: scale(0.3) rotate(-10deg); }
      50% { opacity: 1; transform: scale(1.1) rotate(5deg); }
      70% { transform: scale(0.95) rotate(-2deg); }
      100% { transform: scale(1) rotate(0deg); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 0, 0.7); }
      50% { transform: scale(1.05); }
      70% { box-shadow: 0 0 0 15px rgba(255, 255, 0, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 0, 0); }
    }
    
    @keyframes pulseWarning {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
  </style>
  <style>
    input,
    textarea,
    select {
      font-size: 16px; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    }
  </style>
</head>
<body>
  <header>
    <img src="img/zz.jpg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©" class="logo" />
   <a href="index.html" class="back-btn">â† Ø±Ø¬ÙˆØ¹</a>
  </header>

  <div class="container">
    <h1>Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h1>
    
    <div style="display: none;" class="no-firebase-warning">
      âš¡ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ - Ù„Ø§ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±
    </div>
    
    <div id="error-message" class="error-message"></div>
    <div id="success-message" class="success-message"></div>
    
    <div id="cart-items-container">
      <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù‡Ù†Ø§ Ø¹Ø¨Ø± JavaScript -->
    </div>
    <div id="empty-cart-message" class="empty-cart" style="display: none;">
      <p>Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ ÙØ§Ø±ØºØ©</p>
      <a href="index.html" style="color: yellow;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø±</a>
    </div>
    <div id="total-section" class="total-section" style="display: none;">
      <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="cart-total">0</span> Ø¬Ù†ÙŠÙ‡Ø§Ù‹</h3>
      <button class="checkout-btn" onclick="cartManager.proceedToCheckout()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
    </div>
  </div>

  <div class="cache-status" id="cache-status">âœ… Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹</div>

  <script>
    // =============================================
    // ğŸš€ Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ - Ø¨Ø¯ÙˆÙ† ÙØ§ÙŠØ±Ø¨ÙŠØ²!
    // =============================================
    
    class CartManager {
      constructor() {
        this.cart = JSON.parse(localStorage.getItem('cart')) || [];
        this.productsCache = null;
        this.cacheTimestamp = 0;
        this.init();
      }
      
      init() {
        console.log('ğŸš€ Ø¨Ø¯Ø¡ Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠ...');
        this.loadProductsFromCache();
        this.displayCart();
        this.updateCacheStatus();
      }
      
      // ğŸ” Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage ÙÙ‚Ø·
      loadProductsFromCache() {
        try {
          const cacheData = localStorage.getItem('products_cache');
          if (!cacheData) {
            this.showError('âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯. Ø§Ù„Ø±Ø¬Ø§Ø¡:<br>1. Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø±<br>2. Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª<br>3. Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø³Ù„Ø©');
            return false;
          }
          
          const parsed = JSON.parse(cacheData);
          this.productsCache = new Map(parsed.data || []);
          this.cacheTimestamp = parsed.timestamp || 0;
          
          console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${this.productsCache.size} Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ`);
          return true;
          
        } catch (error) {
          console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©:', error);
          this.showError('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©');
          return false;
        }
      }
      
      // ğŸ“Š ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ø´
      updateCacheStatus() {
        const statusEl = document.getElementById('cache-status');
        if (!statusEl) return;
        
        if (!this.productsCache) {
          statusEl.textContent = 'âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª';
          statusEl.style.color = '#ff3333';
          return;
        }
        
        const cacheAge = Date.now() - this.cacheTimestamp;
        const minutes = Math.floor(cacheAge / 60000);
        const hours = Math.floor(minutes / 60);
        
        if (minutes < 5) {
          statusEl.textContent = 'âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¯ÙŠØ«Ø© Ø¬Ø¯Ø§Ù‹';
          statusEl.style.color = '#4CAF50';
        } else if (minutes < 60) {
          statusEl.textContent = `âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¯ÙŠØ«Ø© (${minutes} Ø¯Ù‚ÙŠÙ‚Ø©)`;
          statusEl.style.color = '#4CAF50';
        } else if (hours < 24) {
          statusEl.textContent = `âš ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø° ${hours} Ø³Ø§Ø¹Ø©`;
          statusEl.style.color = '#ff9800';
        } else {
          statusEl.textContent = `â›” Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¯ÙŠÙ…Ø© (${hours} Ø³Ø§Ø¹Ø©)`;
          statusEl.style.color = '#ff3333';
        }
      }
      
      // ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„ÙƒØ§Ø´
      getProductFromCache(productId) {
        if (!this.productsCache) {
          if (!this.loadProductsFromCache()) {
            return null;
          }
        }
        
        if (!this.productsCache || !this.productsCache.has(productId)) {
          console.warn(`âš ï¸ Ø§Ù„Ù…Ù†ØªØ¬ ${productId} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„ÙƒØ§Ø´`);
          return null;
        }
        
        return this.productsCache.get(productId);
      }
      
      // ğŸ“‹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙ‚Ø·
      validateProduct(productId, requestedQuantity, currentQuantity = 0) {
        const productData = this.getProductFromCache(productId);
        if (!productData) {
          return {
            valid: false,
            message: 'Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©',
            stock: 0,
            maxOrder: 0
          };
        }
        
        const finalQuantity = currentQuantity + requestedQuantity;
        
        // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„Ù…Ù†ØªØ¬
        if (productData.available === false) {
          return {
            valid: false,
            message: 'â›” Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹',
            stock: 0,
            maxOrder: 0
          };
        }
        
        // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø·Ù„Ø¨
        if (productData.maxOrder > 0 && finalQuantity > productData.maxOrder) {
          return {
            valid: false,
            message: `ğŸš« Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø·Ù„Ø¨ Ù‡Ùˆ ${productData.maxOrder} ÙˆØ­Ø¯Ø©`,
            stock: productData.stock || 0,
            maxOrder: productData.maxOrder
          };
        }
        
        // 3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        if (!productData.unlimitedStock && productData.stock !== undefined) {
          if (finalQuantity > productData.stock) {
            return {
              valid: false,
              message: `âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø®Ø²ÙˆÙ† ÙƒØ§ÙÙŠ. Ø§Ù„Ù…ØªØ§Ø­: ${productData.stock} ÙˆØ­Ø¯Ø©`,
              stock: productData.stock,
              maxOrder: productData.maxOrder || 0
            };
          }
        }
        
        return {
          valid: true,
          message: '',
          stock: productData.stock || 0,
          maxOrder: productData.maxOrder || 0,
          price: productData.price,
          name: productData.name
        };
      }
      
      // ğŸ“ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø© (Ø¨Ø¯ÙˆÙ† ÙØ§ÙŠØ±Ø¨ÙŠØ²)
      displayCart() {
        const cartItemsContainer = document.getElementById('cart-items-container');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const totalSection = document.getElementById('total-section');
        
        if (this.cart.length === 0) {
          cartItemsContainer.innerHTML = '';
          emptyCartMessage.style.display = 'block';
          totalSection.style.display = 'none';
          this.updateCacheStatus();
          return;
        }
        
        emptyCartMessage.style.display = 'none';
        totalSection.style.display = 'block';
        
        cartItemsContainer.innerHTML = '';
        let total = 0;
        let hasErrors = false;
        
        this.cart.forEach((item, index) => {
          const productData = this.getProductFromCache(item.id) || {};
          const validation = this.validateProduct(item.id, 0, item.quantity);
          
          const itemElement = document.createElement('div');
          itemElement.className = 'cart-item';
          itemElement.innerHTML = `
            <div class="item-info">
              <h3>${item.name}</h3>
              <p>Ø§Ù„Ø³Ø¹Ø±: ${item.price} Ø¬</p>
              ${productData.stock !== undefined ? 
                `<div class="stock-info">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${productData.stock} ÙˆØ­Ø¯Ø©</div>` : ''}
              ${productData.maxOrder ? 
                `<div class="max-order-info">ğŸ“Š Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: ${productData.maxOrder} ÙˆØ­Ø¯Ø©</div>` : ''}
              ${!validation.valid ? 
                `<div style="color:#ff3333; font-size:12px; margin-top:5px;">${validation.message}</div>` : ''}
            </div>
            <div class="item-controls">
              <div class="quantity-controls">
                <button class="quantity-btn" 
                        onclick="cartManager.updateQuantity(${index}, -1)"
                        ${item.quantity <= 1 ? 'disabled' : ''}>-</button>
                <input type="number" class="quantity-input" value="${item.quantity}" min="1" 
                       onchange="cartManager.updateQuantityDirect(${index}, this.value)" 
                       oninput="cartManager.validateInput(this)">
                <button class="quantity-btn" 
                        onclick="cartManager.updateQuantity(${index}, 1)"
                        ${!validation.valid ? 'disabled' : ''}>+</button>
              </div>
              <button class="remove-btn" onclick="cartManager.removeItem(${index})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
            </div>
          `;
          cartItemsContainer.appendChild(itemElement);
          
          if (!validation.valid) hasErrors = true;
          
          total += parseFloat(item.price) * item.quantity;
        });
        
        document.getElementById('cart-total').textContent = total.toFixed(2);
        this.updateCacheStatus();
        
        // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£Ø®Ø·Ø§Ø¡
        const checkoutBtn = document.querySelector('.checkout-btn');
        if (checkoutBtn) {
          checkoutBtn.disabled = hasErrors;
          checkoutBtn.style.opacity = hasErrors ? '0.5' : '1';
          checkoutBtn.style.cursor = hasErrors ? 'not-allowed' : 'pointer';
        }
      }
      
      // ğŸ”¢ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ© (Ø¨Ø¯ÙˆÙ† ÙØ§ÙŠØ±Ø¨ÙŠØ²)
      updateQuantity(index, change) {
        const item = this.cart[index];
        if (!item) return;
        
        const newQuantity = item.quantity + change;
        
        if (newQuantity < 1) {
          this.removeItem(index);
          return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·
        const validation = this.validateProduct(item.id, change, item.quantity);
        
        if (!validation.valid) {
          this.showError(validation.message);
          return;
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ©
        this.cart[index].quantity = newQuantity;
        this.saveCart();
        this.displayCart();
        
        if (change > 0) {
          this.showSuccess(`âœ… ØªÙ… Ø²ÙŠØ§Ø¯Ø© ${item.name} Ø¥Ù„Ù‰ ${newQuantity} ÙˆØ­Ø¯Ø©`);
        } else {
          this.showSuccess(`âœ… ØªÙ… ØªÙ‚Ù„ÙŠÙ„ ${item.name} Ø¥Ù„Ù‰ ${newQuantity} ÙˆØ­Ø¯Ø©`);
        }
      }
      
      // âŒ¨ï¸ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ© ÙŠØ¯ÙˆÙŠØ§Ù‹ (Ø¨Ø¯ÙˆÙ† ÙØ§ÙŠØ±Ø¨ÙŠØ²)
      updateQuantityDirect(index, newQuantity) {
        newQuantity = parseInt(newQuantity);
        const item = this.cart[index];
        if (!item || isNaN(newQuantity)) return;
        
        if (newQuantity < 1) {
          this.removeItem(index);
          return;
        }
        
        const change = newQuantity - item.quantity;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·
        const validation = this.validateProduct(item.id, change, item.quantity);
        
        if (!validation.valid) {
          this.showError(validation.message);
          // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
          const inputs = document.querySelectorAll('.quantity-input');
          if (inputs[index]) inputs[index].value = item.quantity;
          return;
        }
        
        this.cart[index].quantity = newQuantity;
        this.saveCart();
        this.displayCart();
        this.showSuccess(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ…ÙŠØ© ${item.name} Ø¥Ù„Ù‰ ${newQuantity}`);
      }
      
      // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
      validateInput(input) {
        if (input.value < 1) {
          input.value = 1;
        }
      }
      
      // ğŸ—‘ï¸ Ø¥Ø²Ø§Ù„Ø© Ø¹Ù†ØµØ±
      removeItem(index) {
        const item = this.cart[index];
        if (!item) return;
        
        if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù "${item.name}" Ù…Ù† Ø§Ù„Ø³Ù„Ø©ØŸ`)) {
          this.cart.splice(index, 1);
          this.saveCart();
          this.displayCart();
          this.showSuccess(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù ${item.name} Ù…Ù† Ø§Ù„Ø³Ù„Ø©`);
        }
      }
      
      // ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø©
      saveCart() {
        localStorage.setItem('cart', JSON.stringify(this.cart));
        console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø© ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ');
      }
      
      // ğŸ“Š Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù…Ù„ÙˆØ®ÙŠØ© Ø¨Ø³Ù…Ø©)
      validateRequiredProducts() {
        const requiredProduct = 'basma-molokhia';
        const complementaryProducts = [
          'basma-taro', 'basma-beans', 'basma-mixed-veg', 
          'basma-peas-carrots', 'basma-peas-plain', 'basma-veg-soup',
          'basma-okra-premium', 'basma-okra-zero', 'basma-okra-extra', 
          'basma-okra-grapes', 'basma-okra-strewBerry', 'basma-spinach'
        ];
        
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ù„ÙˆØ®ÙŠØ© ÙÙŠ Ø§Ù„Ø³Ù„Ø©
        const molokhiaItem = this.cart.find(item => item.id === requiredProduct);
        
        // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ù„ÙˆØ®ÙŠØ©ØŒ ÙŠÙ…ÙƒÙ† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
        if (!molokhiaItem) {
          return { isValid: true, message: "" };
        }
        
        const molokhiaQuantity = molokhiaItem.quantity;
        
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙƒÙ…ÙŠÙ„ÙŠØ© ÙÙŠ Ø§Ù„Ø³Ù„Ø©
        const complementaryItems = this.cart.filter(item => 
          complementaryProducts.includes(item.id) && item.id !== requiredProduct
        );
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù†ØªØ¬ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙƒÙ…ÙŠÙ„ÙŠØ©
        if (complementaryItems.length === 0) {
          return { 
            isValid: false, 
            message: 'âš ï¸ Ù„Ù‚Ø¯ Ø·Ù„Ø¨Øª Ù…Ù„ÙˆØ®ÙŠØ© Ø¨Ø³Ù…Ø© ÙÙ‚Ø·. ÙŠØ¬Ø¨ Ø·Ù„Ø¨ Ø£ÙŠ Ù…Ù†ØªØ¬ Ø¢Ø®Ø± Ù…Ù† Ø®Ø¶Ø±ÙˆØ§Øª Ø¨Ø³Ù…Ø© Ø¨Ù†ÙØ³ ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù„ÙˆØ®ÙŠØ© Ø£Ùˆ Ø²ÙŠØ§Ø¯Ø©'
          };
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒÙ…ÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙƒÙ…ÙŠÙ„ÙŠØ© >= ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù„ÙˆØ®ÙŠØ©
        const totalComplementaryQuantity = complementaryItems.reduce((total, item) => {
          return total + item.quantity;
        }, 0);
        
        if (totalComplementaryQuantity < molokhiaQuantity) {
          return { 
            isValid: false, 
            message: 'âš ï¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒÙ…ÙŠØ© Ø®Ø¶Ø±ÙˆØ§Øª Ø¨Ø³Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ø³Ø§ÙˆÙŠ Ø£Ùˆ Ø£ÙƒØ¨Ø± Ù…Ù† ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù„ÙˆØ®ÙŠØ©'
          };
        }
        
        return { isValid: true, message: "" };
      }
      
      // ğŸ›’ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¯ÙØ¹ (Ø¨Ø¯ÙˆÙ† ÙØ§ÙŠØ±Ø¨ÙŠØ²)
      proceedToCheckout() {
        // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user) {
          this.showError('ğŸ”’ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨');
          setTimeout(() => window.location.href = 'login.html', 2000);
          return;
        }
        
        // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù†ØªØ¬Ø§Øª
        if (this.cart.length === 0) {
          this.showError('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©');
          return;
        }
        
        // 3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        const requiredValidation = this.validateRequiredProducts();
        if (!requiredValidation.isValid) {
          this.showError(requiredValidation.message);
          return;
        }
        
        // 4. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        let allProductsValid = true;
        let errorMessages = [];
        
        this.cart.forEach(item => {
          const validation = this.validateProduct(item.id, 0, item.quantity);
          if (!validation.valid) {
            allProductsValid = false;
            errorMessages.push(`${item.name}: ${validation.message}`);
          }
        });
        
        if (!allProductsValid) {
          this.showError(`ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:<br>${errorMessages.join('<br>')}`);
          return;
        }
        
        // 5. ÙƒÙ„ Ø´ÙŠØ¡ Ø¬ÙŠØ¯ØŒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¯ÙØ¹
        console.log('âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØµØ§Ù„Ø­Ø©ØŒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¯ÙØ¹');
        window.location.href = 'checkout.html';
      }
      
      // ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©
      clearCart() {
        if (this.cart.length === 0) return;
        
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ')) {
          this.cart = [];
          this.saveCart();
          this.displayCart();
          this.showSuccess('ğŸ§¹ ØªÙ… Ù…Ø³Ø­ Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„');
        }
      }
      
      // ğŸ”” Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
      showError(message) {
        const errorEl = document.getElementById('error-message');
        if (errorEl) {
          errorEl.innerHTML = message;
          errorEl.style.display = 'block';
          setTimeout(() => errorEl.style.display = 'none', 5000);
        }
        console.error('âŒ ' + message.replace(/<br>/g, ' '));
      }
      
      showSuccess(message) {
        const successEl = document.getElementById('success-message');
        if (successEl) {
          successEl.textContent = message;
          successEl.style.display = 'block';
          setTimeout(() => successEl.style.display = 'none', 3000);
        }
        console.log('âœ… ' + message);
      }
      
      showWarning(message) {
        this.showError(`âš ï¸ ${message}`);
      }
    }
    
    // =============================================
    // ğŸ¯ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    // =============================================
    
    let cartManager;
    
    document.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ø©...');
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¯ÙŠØ± Ø§Ù„Ø³Ù„Ø©
      cartManager = new CartManager();
      
      // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©
      addClearCartButton();
      
      console.log('âœ… ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¬Ø§Ù‡Ø²Ø©');
      console.log('ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø©:', cartManager.cart.length);
    });
    
    // ğŸ§¹ Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©
    function addClearCartButton() {
      const clearBtn = document.createElement('button');
      clearBtn.innerHTML = 'ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©';
      clearBtn.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        display: none !important;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(255, 65, 108, 0.3);
        transition: all 0.3s ease;
      `;
      clearBtn.onmouseover = () => clearBtn.style.transform = 'scale(1.05)';
      clearBtn.onmouseout = () => clearBtn.style.transform = 'scale(1)';
      clearBtn.onclick = () => cartManager.clearCart();
      
      document.body.appendChild(clearBtn);
    }
    
    // =============================================
    // ğŸ“± Ø¬Ø¹Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
    // =============================================
    
    window.cartManager = cartManager;
    
  </script>
</body>
</html>

